<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>자료 관리(관리자)</title>
  <link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:700,400&display=swap" rel="stylesheet">
  <style>
    body { background: #f6faf6; font-family: 'Noto Sans KR', Arial, sans-serif; }
    .admin-table-box { max-width: 1000px; margin: 60px auto 0; background: #fff; border-radius: 14px; box-shadow: 0 6px 32px #22b66111; padding: 32px 26px; }
    h2 { margin-bottom: 20px; text-align: center; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; font-size: 1rem; }
    th { background: #e8fbe9; color: #1fa266; }
    tr:last-child td { border-bottom: none; }
    .delete-btn, .edit-btn {
      background: #f45a6a; color: #fff; border: none; border-radius: 5px;
      padding: 6px 14px; cursor: pointer; font-size: 0.98rem; margin: 0 2px;
      transition: background 0.13s;
    }
    .delete-btn:hover { background: #c8303d; }
    .edit-btn { background: #3fa0ed; }
    .edit-btn:hover { background: #217ac4; }
    .msg { text-align:center; margin-top:10px; font-size:1rem; }
  </style>
</head>
<body>
  <div class="admin-table-box">
    <h2>자료 관리 (관리자)</h2>
    <div class="msg" id="msg"></div>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>관</th>
          <th>지역</th>
          <th>구/군</th>
          <th>학교</th>
          <th>학년</th>
          <th>연도</th>
          <th>학기</th>
          <th>제목</th>
          <th>파일</th>
          <th>관리</th>
        </tr>
      </thead>
      <tbody id="file-list">
        <!-- JS로 채움 -->
      </tbody>
    </table>
  </div>
  <script>
    async function fetchFiles() {
      const res = await fetch('http://localhost:3001/api/files');
      const list = await res.json();
      renderTable(list);
    }

    function renderTable(list) {
      const tbody = document.getElementById('file-list');
      if (!list.length) {
        tbody.innerHTML = `<tr><td colspan="11" style="text-align:center;color:#bbb;">자료가 없습니다</td></tr>`;
        return;
      }
      tbody.innerHTML = list.map(row => `
        <tr>
          <td>${row.id}</td>
          <td>${row.level || '-'}</td>
          <td>${row.region}</td>
          <td>${row.district}</td>
          <td>${row.school}</td>
          <td>${row.grade}</td>
          <td>${row.year}</td>
          <td>${row.semester}</td>
          <td>${row.title}</td>
          <td>
            <a href="/uploads/${row.filename}" target="_blank">파일보기</a>
          </td>
          <td>
            <button class="edit-btn" onclick="editFile(${row.id})">수정</button>
            <button class="delete-btn" onclick="deleteFile(${row.id}, this)">삭제</button>
          </td>
        </tr>
      `).join('');
    }

    async function deleteFile(id, btn) {
      if (!confirm('정말 삭제하시겠습니까?')) return;
      btn.disabled = true;
      try {
        const res = await fetch('http://localhost:3001/api/files/' + id, { method: 'DELETE' });
        const result = await res.json();
        document.getElementById('msg').textContent = result.message || result.msg;
        fetchFiles();
      } catch (e) {
        document.getElementById('msg').textContent = '삭제 오류';
      }
      btn.disabled = false;
    }

    function editFile(id) {
      alert('수정 기능은 추후 구현 (예: 팝업에서 정보 수정)');
      // 여기에 수정 폼을 추가하거나, modal 띄우기 등 구현
    }

    window.onload = fetchFiles;
  </script>
</body>
</html>
