var $="https://js.tosspayments.com/v2/standard";function N(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(c){return c.__proto__||Object.getPrototypeOf(c)},m(e)}function v(e,t){return v=Object.setPrototypeOf||function(o,n){return o.__proto__=n,o},v(e,t)}function T(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _(e,t,c){return T()?_=Reflect.construct:_=function(n,l,a){var p=[null];p.push.apply(p,l);var f=Function.bind.apply(n,p),y=new f;return a&&v(y,a.prototype),y},_.apply(null,arguments)}function q(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function g(e){var t=typeof Map=="function"?new Map:void 0;return g=function(o){if(o===null||!q(o))return o;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(o))return t.get(o);t.set(o,n)}function n(){return _(o,arguments,m(this).constructor)}return n.prototype=Object.create(o.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),v(n,o)},g(e)}function x(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function K(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return x(e)}function R(e){var t=T();return function(){var o=m(e),n;if(t){var l=m(this).constructor;n=Reflect.construct(o,arguments,l)}else n=o.apply(this,arguments);return K(this,n)}}var h=null;function A(e,t){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(h!=null)return h;var o=new Promise(function(n,l){try{var a=function(){E(t)!=null?n(E(t)):l(new C(t))},p=function(){l(new F(e))};if(typeof window>"u"||typeof document>"u")return n(null);if(E(t)!=null)return n(E(t));var f=document.querySelector('script[src="'.concat(e,'"]'));if(f!=null){var y;f.removeEventListener("load",a),f.removeEventListener("error",p),(y=f.parentElement)===null||y===void 0||y.removeChild(f)}var s=document.createElement("script");s.src=e,s.addEventListener("load",a),s.addEventListener("error",p),c.priority!=null&&(s.fetchPriority=c.priority),document.head.appendChild(s)}catch(u){l(u);return}});return h=o.catch(function(n){return h=null,Promise.reject(n)}),h}function E(e){return window[e]}var C=(function(e){P(c,e);var t=R(c);function c(o){var n;return N(this,c),n=t.call(this,"[TossPayments SDK] ".concat(o," is not available")),n.name="NamespaceNotAvailableError",n}return c})(g(Error)),F=(function(e){P(c,e);var t=R(c);function c(o){var n;return N(this,c),n=t.call(this,"[TossPayments SDK] Failed to load script: [".concat(o,"]")),n.name="ScriptLoadFailedError",n}return c})(g(Error));function I(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=t.src,o=c===void 0?$:c;return typeof window>"u"?Promise.resolve({}):A(o,"TossPayments").then(function(n){return n(e)})}document.addEventListener("DOMContentLoaded",()=>{const e=typeof window<"u"&&window.TOSS_CLIENT_KEY?window.TOSS_CLIENT_KEY:"test_ck_xxx",t=r=>document.querySelector(r),c=r=>Array.from(document.querySelectorAll(r)),o=t("#mBtn"),n=t("#yBtn"),l=c(".plan"),a=t("#subscribeBtn"),p=t("#agree"),f=t("#chosen"),y=c(".methods .chip");let s="month",u=null,O="toss",L=!1;const S=r=>Number(r).toLocaleString("ko-KR");y.forEach(r=>{r.addEventListener("click",()=>{y.forEach(i=>i.classList.remove("active")),r.classList.add("active"),O=r.dataset.method||"toss"})}),l.forEach(r=>{r.querySelector(".select-btn")?.addEventListener("click",()=>{l.forEach(k=>k.classList.remove("selected")),r.classList.add("selected");const d=r.dataset.plan,w=Number(s==="year"?r.dataset.year:r.dataset.month);u={id:d,price:w};const B=r.querySelector("h3")?.textContent.trim()||d;f.textContent=`${B} - ${S(w)}원 / ${s==="year"?"년":"월"}`,b()})}),[o,n].forEach(r=>{r.addEventListener("click",()=>{const i=r===o;s=i?"month":"year",o.classList.toggle("active",i),n.classList.toggle("active",!i);const d=document.querySelector(".plan.selected");if(d&&u){u.price=Number(i?d.dataset.month:d.dataset.year);const w=d.querySelector("h3")?.textContent.trim()||u.id;f.textContent=`${w} - ${S(u.price)}원 / ${s==="year"?"년":"월"}`}b()})}),p.addEventListener("change",b);function b(){a.disabled=!(p.checked&&u)}async function j(r){try{await(await I(e)).payment({customerKey:r.customerKey}).requestBillingAuth({method:"CARD",successUrl:r.successUrl,failUrl:r.failUrl})}catch(i){console.error("Toss billing open error:",i),alert(`토스 호출 실패: ${i?.message||i}`)}}a.addEventListener("click",async()=>{if(!(a.disabled||L)){if(O!=="toss"){alert("지금은 토스 간편결제만 지원합니다.");return}L=!0,a.disabled=!0;try{const r=await fetch("/api/billing/start",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({plan:u?.id,cycle:s})});if(r.status===401){alert("로그인 후 이용해주세요."),location.href="/login.html?next=/pricing.html";return}if(!r.ok){const d=await r.text().catch(()=>r.statusText);throw new Error(d||"초기화 실패")}const i=await r.json();await j(i)}catch(r){console.error(r),alert("결제를 시작할 수 없습니다. 잠시 후 다시 시도해주세요.")}finally{L=!1,a.disabled=!1}}}),b()});
