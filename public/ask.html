<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë¬¸ì˜/ì‹œí—˜ì§€ì—…ë¡œë“œ ê²Œì‹œíŒ</title>
  <link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:700,400&display=swap" rel="stylesheet">
  <style>
    .clickable-row { cursor: pointer; }
    .clickable-row:hover { background: #f5ecfa; }
    .clickable-row .board-title { transition: color .2s; }
    .clickable-row:hover .board-title { color: #a86cf2; }
    body { background:#fff; font-family:'Noto Sans KR',Arial,sans-serif; margin:0;}
    /* GNB(ìƒë‹¨) - ë¡œê³  + ë¡œê·¸ì¸/ê¸°ìˆ ì§€ì› */
    .gnb { height:64px; border-bottom:1.5px solid #eee; display:flex; align-items:center; padding:0 44px;}
    .gnb .logo { color:#7125b7; font-weight:900; font-size:2.1rem; letter-spacing:-2px;}
    .gnb .right { margin-left:auto; display:flex; align-items:center; gap:12px; }
    .gnb .right button { background:#7125b7; color:#fff; border-radius:18px; border:0; font-weight:700; font-size:1rem; padding:8px 20px; cursor:pointer;}
    .container {
      max-width: 1300px;      /* â†’ ì´ ìˆ˜ì¹˜ë¥¼ í‚¤ìš°ë©´ ê°€ë¡œë¡œ ë” ë„“ì–´ì§ */
      margin: 64px auto 0;    /* â†’ ìœ„ ì—¬ë°±(64px), ì¢Œìš°ëŠ” í•­ìƒ ê°€ìš´ë°(auto) */
      padding: 0px 20px;     /* â†’ ì•ˆìª½ì—¬ë°±(ìƒí•˜40px, ì¢Œìš°40px) */
    }
    .page-title { font-size:2.5rem; font-weight:900; margin-bottom:28px;}W
    /* íƒ­ */
    .sub-tab-bar { display:flex; gap:60px; border-bottom:2.5px solid #ececec; margin-bottom:18px;}
    .sub-tab-bar button {
      color:#222; background:none; border:none; font-size:1.19rem; font-weight:700; padding:0 0 14px 0; margin:0 0 -2.5px 0; border-bottom:2.5px solid transparent; cursor:pointer; transition:.2s;
    }
    .sub-tab-bar button.active {
      color:#7125b7;
      border-color:#7125b7;
    }
    .sub-tab-bar > button:not(:last-child) {
      margin-right: 20px !important;
    }

    /* ê²Œì‹œíŒ í…Œì´ë¸” */
    .board-table { width:100%; border-collapse:collapse; margin-top: 18px;}
    .board-table th, .board-table td { border-bottom:1px solid #ebebeb; text-align:left; padding:14px 8px; font-size:1.04rem;}
    .board-table th { color:#444; background:#f9f9fb; font-weight:700;}
    .board-table td { color:#222;}
    .board-table tr:hover td { background:#f8f6ff; }
    .board-table td.center { text-align:center; color:#999; }
    /* ë²„íŠ¼ */
    .btn-primary { background:#7125b7; color:#fff; border:0; border-radius:7px; font-weight:700; font-size:1.11rem; padding:12px 42px; cursor:pointer; margin-top:36px; float:right;}
    .btn-primary:active { filter:brightness(0.9);}
    /* íŒŒì¼ ì•„ì´ì½˜ ë³´ë¼ìƒ‰ */
    .file-purple { color:#7125b7;}
    @media (max-width:950px) {.container{width:98vw;padding:0 2vw;}}
    /* ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ */
    #pwModal { display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:#0006; z-index:2000; align-items:center; justify-content:center;}
    #pwModal .pw-inner { background:#fff; border-radius:12px; padding:38px 44px; min-width:340px; }
  </style>
</head>
<body>
  <!-- ìƒë‹¨ GNB(ë¡œê³  + ë¡œê·¸ì¸/ê¸°ìˆ ì§€ì›) -->
  <nav class="gnb">
    <div class="logo">ìˆ˜í•™ì§€ë‹ˆ</div>
    <div class="right">
      <button>ë¡œê·¸ì¸</button>
      <button style="background:#4a1e84;">ê¸°ìˆ ì§€ì› ë°”ë¡œê°€ê¸°</button>
    </div>
  </nav>
  <div class="container">
    <div class="page-title" id="pageTitle">ë¬¸ì˜í•˜ê¸°</div>
    <!-- í•˜ìœ„ íƒ­ -->
    <div class="sub-tab-bar">
      <button id="tabAsk" class="active" onclick="showTab('ask')">ë¬¸ì˜í•˜ê¸°</button>
      <button id="tabEdit" onclick="showTab('edit')">ìˆ˜ì •ìš”ì²­</button>
      <button id="tabUpload" onclick="showTab('upload')">ì‹œí—˜ì§€ì—…ë¡œë“œ</button>
    </div>
    <!-- ë¬¸ì˜í•˜ê¸° ê²Œì‹œíŒ -->
    <div id="askBoard">
      <table class="board-table">
        <thead>
          <tr>
            <th style="width:60%;">ì œëª©</th>
            <th style="width:13%;">ë‚ ì§œ</th>
            <th style="width:10%;">íŒŒì¼</th>
            <th style="width:10%;">ì¡°íšŒìˆ˜</th>
          </tr>
        </thead>
        <tbody id="askTbody"></tbody>
      </table>
      <button class="btn-primary" onclick="location.href='ask2.html'">ë¬¸ì˜í•˜ê¸°</button>
    </div>
    <!-- ì‹œí—˜ì§€ì—…ë¡œë“œ ê²Œì‹œíŒ -->
    <div id="uploadBoard" style="display:none;">
      <table class="board-table">
        <thead>
          <tr>
            <th style="width:60%;">ì œëª©</th>
            <th style="width:13%;">ë‚ ì§œ</th>
            <th style="width:10%;">íŒŒì¼</th>
            <th style="width:10%;">ì¡°íšŒìˆ˜</th>
          </tr>
        </thead>
        <tbody id="uploadTbody"></tbody>
      </table>
      <button class="btn-primary" onclick="location.href='ask2.html'">ì‹œí—˜ì§€ì—…ë¡œë“œ</button>
    </div>
  </div>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ (body ë§¨ ì•„ë˜) -->
  <div id="pwModal">
    <div class="pw-inner">
      <div style="font-weight:700; font-size:1.17rem; margin-bottom:18px;">ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</div>
      <form id="pwForm">
        <input type="password" id="pwInput" maxlength="4" style="font-size:1.1rem; padding:8px 10px;" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
        <button type="submit" style="margin-left:8px; padding:7px 20px;">í™•ì¸</button>
      </form>
      <div id="pwMsg" style="color:#c34; margin-top:9px;"></div>
    </div>
  </div>

  <script>
    
      // ğŸ”µ Render ì„œë²„ ì£¼ì†Œ(ë³¸ì¸ê±¸ë¡œ ë°”ê¿”ì¤˜!)
      const RENDER_URL = "https://mathpb-server.onrender.com";

      // í˜„ì¬ íƒ­
      let currentType = "ask";
      let typeToName = {
        ask: "ë¬¸ì˜í•˜ê¸°",
        edit: "ìˆ˜ì •ìš”ì²­",
        upload: "ì‹œí—˜ì§€ì—…ë¡œë“œ"
      };

      // íƒ­ ì „í™˜
      function showTab(tab) {
        currentType = tab;
        document.getElementById('tabAsk').classList.toggle('active', tab==='ask');
        document.getElementById('tabEdit').classList.toggle('active', tab==='edit');
        document.getElementById('tabUpload').classList.toggle('active', tab==='upload');
        document.getElementById('pageTitle').innerText = typeToName[tab] || "ê²Œì‹œíŒ";
        document.getElementById('writeBtn').innerText = typeToName[tab];
        loadBoard(tab);
      }


    // DBì—ì„œ ì‹¤ì œ ê¸€ ëª©ë¡ì„ ë¶ˆëŸ¬ì™€ì„œ í…Œì´ë¸”ì— ë¿Œë¦¬ëŠ” í•¨ìˆ˜!
    function loadBoard(type) {
      fetch(`${RENDER_URL}/api/board?type=${type}`)
        .then(res => res.json())
        .then(data => {
          const tbody = document.getElementById('boardTbody');
          tbody.innerHTML = '';
          data.forEach(row => {
            tbody.innerHTML += `
              <tr class="clickable-row" data-id="${row.id}" data-password="${row.password || ''}">
                <td>
                  ${row.password ? '<i class="fa-solid fa-lock" style="color:#aaa;margin-right:6px;"></i> (ë¹„ê³µê°œ) ' : ''}
                  <span class="board-title">${row.title}</span>
                </td>
                <td>${row.created_at ? row.created_at.slice(0,10) : ''}</td>
                <td class="center">${row.files ? '<i class="fa-regular fa-paperclip file-purple"></i>' : '-'}</td>
                <td class="center">-</td>
              </tr>
            `;
          });
        });
    }

    // í˜ì´ì§€ê°€ ì—´ë¦´ ë•Œ ìë™ìœ¼ë¡œ ëª©ë¡ ë‘ ê°œ ë‹¤ ë¶ˆëŸ¬ì˜¤ê¸°!
    window.onload = function() {
      showTab('ask');
    };

    // ê¸€ì“°ê¸° ë²„íŠ¼
    document.getElementById('writeBtn').onclick = function() {
      location.href = `ask2.html?type=${currentType}`;
    };

    // ê²Œì‹œê¸€ tr í´ë¦­ì‹œ ë¹„ë²ˆ ëª¨ë‹¬
    document.addEventListener("click", function(e){
      const row = e.target.closest(".clickable-row");
      if(row) {
        const password = row.dataset.password;
        const id = row.dataset.id;
        showPwModal(id, password);
      }
    });

    // ëª¨ë‹¬
    let targetId = null;
    let realPw = null;
    function showPwModal(id, pw) {
      targetId = id;
      realPw = pw;
      document.getElementById('pwInput').value = '';
      document.getElementById('pwMsg').textContent = '';
      document.getElementById('pwModal').style.display = 'flex';
      setTimeout(()=>document.getElementById('pwInput').focus(), 30);
    }
    document.getElementById('pwForm').onsubmit = function(e){
      e.preventDefault();
      if(!realPw || document.getElementById('pwInput').value === realPw){
        document.getElementById('pwModal').style.display = 'none';
        location.href = 'ask_detail.html?id=' + targetId;
      } else {
        document.getElementById('pwMsg').textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
      }
    };
    document.getElementById('pwModal').onclick = function(e){
      if(e.target === this) this.style.display = 'none';
    }
  </script>
</body>
</html>
