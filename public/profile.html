<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>íšŒì› ì •ë³´</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
  <!-- Swiper ê´‘ê³ ë°°ë„ˆìš© -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css">
  <style>

body {
  margin: 0; background: #fff;
  font-family: 'Noto Sans KR', sans-serif;
}

 /* ğŸ”¶ íƒ‘ ê´‘ê³ ë°°ë„ˆ ìŠ¤íƒ€ì¼ */
.top-banner {
  width: 100%;
  height: 400px;
  overflow: hidden;
  border-bottom: 1px solid #eee;
}
.topSwiper,
.topSwiper .swiper-wrapper,
.topSwiper .swiper-slide {
  width: 100%;
  height: 100%;
}
.topSwiper .swiper-slide img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  opacity: 0;
  transition: opacity 0.5s ease;
}
.topSwiper .swiper-slide img.loaded {
  opacity: 1;
}
.topSwiper .swiper-pagination {
  display: none !important;
}

  /* â–£ ëª¨ë‹¬ */
  .modal{position:fixed;inset:0;display:none;align-items:center;
        justify-content:center;background:rgba(0,0,0,.55);z-index:100;}
  .modal-content{max-width:580px;width:90%;background:#fff;border-radius:12px;
                padding:32px 28px;text-align:center;position:relative;}
  .modal-content img{max-width:100%;height:auto;border-radius:10px;}
  .modal-content p{margin-top:18px;font-size:1.05rem;line-height:1.6;}
  .modal-close{position:absolute;right:18px;top:14px;font-size:1.8rem;
              border:none;background:none;color:#555;cursor:pointer;}
  .modal-close:hover{color:#000;}

  .page-header::after{
  content:'';
  position:absolute;
  left:50%;                          /* ê°€ìš´ë° ê¸°ì¤€ */
  bottom:0;                          /* í—¤ë” ë§¨ ì•„ë˜ */
  transform:translateX(-50%);        /* ì •í™•í•œ ì¤‘ì•™ ì •ë ¬ */

  width:97%;                         /* â† ê¸¸ì´(=ì–‘ìª½ ì—¬ë°±) ì¡°ì ˆ í¬ì¸íŠ¸ */
  height:1px;                        /* ì„  êµµê¸° */
  background:var(--border-light);    /* ì„  ìƒ‰ìƒ */
  }
    /* â”€â”€â”€ ì¹´ë“œ ê°€ë¡œ ìŠ¤í¬ë¡¤ í–‰ â”€â”€â”€ */
    .h-scroll        {position:relative;margin:32px 40px;}
    .h-scroll .inner {display:flex;gap:16px;overflow-x:auto;
                      padding:12px 0;scroll-behavior:smooth;}
    .h-scroll .inner::-webkit-scrollbar{display:none;}

    .card-item{
      flex:0 0 210px;                 /* ì¹´ë“œ í­ */
      height:120px;
      border-radius:14px;
      background:#f7f8f9;
      box-shadow:0 2px 6px rgba(0,0,0,.04);
      display:flex;justify-content:center;align-items:center;
      font-weight:700;color:#333;
    }
    .my-desc{ display:none; }
    .modal-content iframe{
      width:100%;
      height:70vh;           /* ì›í•˜ëŠ” ë†’ì´ ë¹„ìœ¨ */
      border:0;
      border-radius:12px;
    }
.dashboard-body {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  margin: 28px 40px 80px;
}
.user-row {
  width: 340px;
  flex-shrink: 0;
  display: flex;
  flex-direction: column;
  gap: 20px;
}
.profile-card {
  width: 280px;
  min-height: 520px;  /* ë‚´ ë¬¸ì œì§€ ì¹´ë“œì™€ ë†’ì´ ë™ì¼í•˜ê²Œ! */
  background: #fff;
  border: 1px solid #e9e9e9;
  border-radius: 22px;
  box-shadow: 0 4px 12px rgba(0,0,0,.04);
  padding: 0 28px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center; /* ìˆ˜ì§/ìˆ˜í‰ ì™„ì „ ì¤‘ì•™ */
}
.profile-center {
  display: flex;
  flex-direction: column;
  align-items: center;
}
.avatar-label {
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  gap: 10px;
}

.change-photo-btn {
  background: #f7f8fa;
  border: 1px solid #ccc;
  border-radius: 9999px;
  padding: 4px 18px;
  font-size: 0.95rem;
  color: #333;
  cursor: pointer;
  margin-top: 2px;
  transition: background .15s, color .15s;
}
.change-photo-btn:hover {
  background: #f0e9ff;
  color: #6c4fc8;
}

.profile-card img {
  width: 74px;
  height: 74px;
  border-radius: 50%;
  object-fit: cover;
}
.profile-card .info {
  text-align: center;
  margin-top: 18px;
}
.profile-card .info h3 {
  font-size: 1.1rem;
  font-weight: 900;
  color: #111;
}
.profile-card .info .role {
  margin-top: 3px;
  font-size: .98rem;
  color: #5f5f5f;
}
.mysheet-board {
  flex: 1 1 420px;
  background: #fff;
  border: 1px solid #e9e9e9;
  border-radius: 22px;
  box-shadow: 0 4px 12px rgba(0,0,0,.04);
  padding: 28px;
  min-height: 420px;
}
.mysheet-board h2 {
  font-size: 1.25rem;
  font-weight: 900;
  margin-bottom: 22px;
}

.grade-label {
  font-weight: 900;
  padding: 3px 16px;
  border-radius: 10px;
  font-size: 1.08rem;
}
.grade-gold   { color: #c09619; background: #fff7c3; }
.grade-silver { color: #6a7a8b; background: #f0f4f7; }
.grade-bronze { color: #be7625; background: #ffe7ce; }

.info.loading *, .member-info.loading * {
  visibility: hidden;
}

.member-info > div {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 14px;
}
.member-info label {
  width: 120px;
  font-weight: 600;
}

.mysheet-board {
  border-radius: 20px;
  padding: 32px;
  background: #fff;
  box-shadow: 0 4px 16px rgba(0,0,0,0.05);
}

#profileAvatar {
  width: 120px;         /* ê¶Œì¥: 80~120px (ì¶”ì²œê°’ì€ 96px) */
  height: 120px;
  border-radius: 50%;
  object-fit: cover;
  background: #eaeaea;
  margin-bottom: 8px;
  border: 2px solid #eee;
  transition: filter .2s;
  margin-bottom: 8px; 
  margin-top: -120px; 
  margin-bottom: 30px;  
}
#profileAvatar:hover { filter: brightness(0.95); }

.change-photo-btn {
  background: #f7f8fa;
  border: 1px solid #ccc;
  border-radius: 9999px;
  padding: 4px 18px;
  font-size: 0.95rem;
  color: #333;
  cursor: pointer;
  margin-top: 2px;
  transition: background .15s, color .15s;
}

  /* [NEW] í”„ë¡œí•„ ì‚¬ì§„ í˜ì´ë“œ-ì¸ */
  #profileAvatar{
    opacity:0;                       /* ì²˜ìŒì—” íˆ¬ëª… */
    transition:opacity .6s ease;     /* 0.6ì´ˆ ë™ì•ˆ ë¶€ë“œëŸ½ê²Œ */
  }
  #profileAvatar.fade-in{opacity:1;} /* í´ë˜ìŠ¤ ë¶™ìœ¼ë©´ ë‚˜íƒ€ë‚¨ */

button {
  background: #6366f1;
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.2s;
}
button:hover {
  background: #4f46e5;
}

input[type="text"],
input[type="password"],
input[type="email"] {
  width: 100%;
  padding: 12px 14px;
  border: 1px solid #ddd;
  border-radius: 8px;
  font-size: 1rem;
  transition: border 0.2s;
}
input:focus {
  border-color: #6366f1;
  outline: none;
}


  </style>
</head>
<body>

<!-- â–£ ê´‘ê³  ìŠ¬ë¼ì´ë” â–£ -->
<section class="top-banner">
  <div class="swiper topSwiper">
    <div class="swiper-wrapper">
      <div class="swiper-slide"><img src="ad_big1.jpg" alt="íƒ‘ ë°°ë„ˆ 1"></div>
      <div class="swiper-slide"><img src="ad_big2.jpg" alt="íƒ‘ ë°°ë„ˆ 2"></div>
      <div class="swiper-slide"><img src="ad_big3.jpg" alt="íƒ‘ ë°°ë„ˆ 3"></div>
    </div>
    <div class="swiper-pagination"></div>
  </div>
</section>

<div class="dashboard-body" style="display:flex;flex-wrap:wrap;gap:20px;margin:28px 40px 80px;">
  <!-- (ì™¼ìª½) í”„ë¡œí•„ ì¹´ë“œ -->
  <div class="user-row" style="width:340px;flex-shrink:0;display:flex;flex-direction:column;gap:20px;">
    <!-- 1) í”„ë¡œí•„ ì¹´ë“œ -->
    <div class="profile-card">
      <div class="profile-center">
        <label class="avatar-label" for="profileImageInput">
          <img id="profileAvatar" alt="avatar">
          <input type="file" id="profileImageInput"
           name="avatar"  
           accept="image/*"
           style="display:none;">
          <div style="display:flex;gap:8px;">
            <button type="button" class="change-photo-btn">ì‚¬ì§„ ë³€ê²½</button>
            <button type="button" class="change-photo-btn" id="savePhotoBtn" style="display:none;">ì €ì¥</button>
            <button type="button" class="change-photo-btn" id="deletePhotoBtn">ì‚­ì œ</button>
          </div>
        </label>
        <div class="info loading">
          <h3 id="profileName">UserName</h3>
          <div class="role" id="profileEmail">user@example.com</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- (ì˜¤ë¥¸ìª½) ë‚´ ë¬¸ì œì§€ ì¹´ë“œ -->
  <div class="mysheet-board" style="flex:1 1 420px; background:#fff;border:1px solid #e9e9e9;border-radius:22px;box-shadow:0 4px 12px rgba(0,0,0,.04);padding:28px;min-height:420px;">
    <h2 style="font-size:1.25rem;font-weight:900;margin-bottom:22px;">íšŒì› ì •ë³´</h2>
<div class="member-info">
  <div style="display:flex; align-items:center; gap:12px; margin-bottom:14px;">
  <label for="mem-id-input" style="width:120px; font-weight:600;">ID</label>
  <input 
    type="text" 
    id="mem-id-input" 
    value="-" 
    disabled 
    style="flex:1; padding:8px; border:1px solid #ddd; border-radius:6px; background:#f7f7f9;"
  />
</div>
  <div><b>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</b></div>
  <div style="display:flex; gap:12px; flex-wrap:wrap; margin-bottom:14px;">
    <input type="password" id="new-password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸" style="flex:1;">
    <input type="password" id="confirm-password" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" style="flex:1;">
    <button id="pw-change-btn" style="padding:10px 18px;border-radius:8px;background:#6366f1;color:#fff;border:none;">ë³€ê²½</button>
  </div>
  <div><b>ì´ë©”ì¼</b> : <span id="mem-email">-</span></div>
  <div><b>íœ´ëŒ€í° ë²ˆí˜¸</b> : <span id="mem-phone">-</span></div>
  <div><b>êµ¬ë…</b> : 
    <span id="mem-subscription" class="grade-label">-</span>
    <button id="subscribeBtn" style="margin-left:10px;display:none;padding:4px 10px;font-size:0.85rem;border-radius:6px;border:none;background:#FDC512;color:#111;cursor:pointer;">êµ¬ë…í•˜ê¸°</button>
  </div>
  <div style="margin-top:18px;"><b>í˜„ê¸ˆì˜ìˆ˜ì¦ ë°œê¸‰ ë²ˆí˜¸</b> :
    <input id="mem-biz-input" type="text" placeholder="ì‚¬ì—…ì/íœ´ëŒ€í°ë²ˆí˜¸" style="width:160px;padding:4px 8px;border:1px solid #ccc;border-radius:7px;font-size:0.95rem;">
    <button id="mem-biz-save">ì €ì¥</button>
    <span id="mem-biz-view" style="margin-left:10px;color:#218155;font-weight:700;display:none;"></span>
  </div>
  <div style="margin-top:18px;"><b>í•™ì› ëª…</b> : 
    <input id="mem-academy-name" type="text" style="width:200px;padding:4px 8px;" placeholder="í•™ì›ëª…">
  </div>
<div style="margin-top:16px;"><b>í•™ì› ì£¼ì†Œ</b> : </div>
<div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:14px;">
  <input id="mem-academy-address-input" type="text" placeholder="í•™ì› ì£¼ì†Œ ì…ë ¥" style="flex:1; padding:10px; border:1px solid #ccc; border-radius:8px;">
  <button id="academy-address-save" style="padding:10px 18px;border-radius:8px;background:#6366f1;color:#fff;border:none;">ë³€ê²½</button>
</div>
<span id="mem-academy-address" style="display:block; color:#333; font-weight:500;">-</span>
  <div><b>í•™ì› ë²ˆí˜¸</b> : 
    <input id="mem-academy-phone" type="text" style="width:160px;padding:4px 8px;" placeholder="ì „í™”ë²ˆí˜¸">
  </div>
  <button id="academy-save-btn" style="margin-top:10px;padding:5px 12px;font-size:0.95rem;border-radius:7px;background:#218155;color:#fff;border:none;cursor:pointer;">í•™ì› ì •ë³´ ì €ì¥</button>
</div>
    <!-- ì›í•˜ëŠ” ë‚´ìš© ì¶”ê°€ -->
  </div>


<!-- Swiper JS (ê´‘ê³ ë°°ë„ˆìš©) -->
<script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
<script>

const topSwiper = new Swiper('.topSwiper', {
  loop: true,
  autoplay: { delay: 4000 },
  effect: 'fade',
  fadeEffect: { crossFade: true },
  speed: 1000,
  allowTouchMove: false,
  simulateTouch: false,
  pagination: {
    el: '.topSwiper .swiper-pagination',
    clickable: false
  }
});

document.querySelectorAll('.topSwiper .swiper-slide img').forEach(img => {
  if (img.complete) {
    img.classList.add('loaded');
  } else {
    img.addEventListener('load', () => {
      img.classList.add('loaded');
    });
  }
});

async function setProfileInfo () {
  try {
    const res = await fetch('/check-auth?ts=' + Date.now(), {
      credentials: 'include',
      cache: 'no-store'
    });
    const d = await res.json();
    if (!d.isLoggedIn) return;            // ë¡œê·¸ì¸ ì•ˆ ë¼ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ë‘ 

    const u = d.user || {};
    const displayId = u.email ? u.email.split('@')[0] : (u.name || 'User');

    /* ì¢Œì¸¡ í”„ë¡œí•„ ì¹´ë“œ */
    document.getElementById('profileName').textContent  = displayId;
    document.getElementById('profileEmail').textContent = u.email || '-';

    const defaultImg = '/icon_my_b.png';
    const av = document.getElementById('profileAvatar');
    av.alt = displayId;
    av.src = defaultImg;                 // ê¸°ë³¸ ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ë³´ì—¬ì¤Œ
    av.style.visibility = 'visible';     // ì¦‰ì‹œ í‘œì‹œ

    if (u.avatarUrl && u.avatarUrl !== defaultImg) {
      const preload = new Image();       // ì‹¤ì œ ì‚¬ì§„ì„ ë°±ê·¸ë¼ìš´ë“œ ë¡œë“œ
      preload.onload = () => { av.src = u.avatarUrl; };
      preload.src = u.avatarUrl;
      
    document.getElementById('mem-id-input').value = u.id || '';
    document.getElementById('mem-academy-address').textContent = u.academyAddress || '-';

    const subLabel = document.getElementById('mem-subscription');
    const subBtn = document.getElementById('subscribeBtn');
    if (u.hasPaid) {
      subLabel.textContent = 'êµ¬ë…ì¤‘';
      subBtn.style.display = 'none';
    } else {
      subLabel.textContent = 'ë¯¸êµ¬ë…';
      subBtn.style.display = 'inline-block';
      subBtn.onclick = () => location.href = '/subscribe';
    }



    }

    /* ìš°ì¸¡ ì •ë³´ ì¹´ë“œ */
    document.getElementById('mem-email').textContent = u.email || '-';
    document.getElementById('mem-phone').textContent = u.phone || '-';

    /* ë“±ê¸‰(ì˜µì…˜) */
    const gradeSpan = document.getElementById('mem-grade');
    let label = '-', cls = '';
    switch ((u.grade || '').toLowerCase()) {
      case 'gold':   label = 'ê³¨ë“œ';   cls = 'grade-gold';   break;
      case 'silver': label = 'ì‹¤ë²„';   cls = 'grade-silver'; break;
      case 'bronze': label = 'ë¸Œë¡ ì¦ˆ'; cls = 'grade-bronze'; break;
    }
    gradeSpan.textContent = label;
    gradeSpan.className   = 'grade-label ' + cls;

    document.querySelector('.info').classList.remove('loading');
    document.querySelector('.member-info').classList.remove('loading');
  } catch (e) {
    console.error(e);
  }
}
setProfileInfo();


document.getElementById('mem-biz-save').onclick = async function() {
  const value = document.getElementById('mem-biz-input').value.trim();
  if(!value) return alert('ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
  try {
    const res = await fetch('/api/update-biznum', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      credentials: 'include',
      body: JSON.stringify({ bizNum: value })
    });
    const d = await res.json();
    if(d.success){
      showBizNum(value);
      alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    } else {
      alert('ì €ì¥ ì‹¤íŒ¨!');
    }
  } catch(e){
    alert('ì˜¤ë¥˜ ë°œìƒ');
  }
};

document.getElementById('academy-save-btn').onclick = async () => {
  const name = document.getElementById('mem-academy-name').value.trim();
  const phone = document.getElementById('mem-academy-phone').value.trim();
  try {
    const res = await fetch('/api/save-academy', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ name, phone })
    });
    const d = await res.json();
    if (d.success) alert('ì €ì¥ ì™„ë£Œ!');
    else alert('ì €ì¥ ì‹¤íŒ¨');
  } catch (e) {
    alert('ì˜¤ë¥˜ ë°œìƒ');
  }
};

function showBizNum(bizNum) {
  document.getElementById('mem-biz-input').style.display = 'none';
  document.getElementById('mem-biz-save').style.display = 'none';
  const v = document.getElementById('mem-biz-view');
  v.textContent = bizNum;
  v.style.display = 'inline';
}

document.querySelector('.change-photo-btn').onclick = function() {
  document.getElementById('profileImageInput').click();
};

let selectedFile = null;

// ì‚¬ì§„ ì„ íƒí•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ë§Œ
document.getElementById('profileImageInput').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;
  selectedFile = file;  // ì €ì¥ ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œ ì „ì†¡í•˜ê¸° ìœ„í•´ ë³´ê´€
  // ë¯¸ë¦¬ë³´ê¸°
  const reader = new FileReader();
  reader.onload = function(evt) {
    document.getElementById('profileAvatar').src = evt.target.result;
  };
  reader.readAsDataURL(file);

  // ì €ì¥ ë²„íŠ¼ í‘œì‹œ
  document.getElementById('savePhotoBtn').style.display = 'inline-block';
});

// ì €ì¥ ë²„íŠ¼ ëˆŒëŸ¬ì•¼ ì„œë²„ì— ì—…ë¡œë“œ
document.getElementById('savePhotoBtn').addEventListener('click', async function() {
  if (!selectedFile) {
    alert('ì‚¬ì§„ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.');
    return;
  }
  const formData = new FormData();
  formData.append('avatar', selectedFile, selectedFile.name); // â† íŒŒì¼ëª… ëª…ì‹œ

  try {
    const res = await fetch('/api/upload-profile-photo', {
      method: 'POST',
      body: formData,
      credentials: 'include'
    });
    const result = await res.json();
    if (result.success && result.avatarUrl) {
      const preload = new Image();
      preload.onload = () => {
        document.getElementById('profileAvatar').src = result.avatarUrl;
      };
      preload.src = result.avatarUrl;

      alert('í”„ë¡œí•„ ì‚¬ì§„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!');
      selectedFile = null;
      document.getElementById('savePhotoBtn').style.display = 'none';
    } else {
      alert('í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  } catch (err) {
    alert('ì—…ë¡œë“œ ì—ëŸ¬: ' + err);
  }
});

// í˜ì´ì§€ ë– ë‚˜ê¸° ì „ì— ì €ì¥ ì•ˆ í–ˆìœ¼ë©´ ê²½ê³ 
window.addEventListener('beforeunload', function (e) {
  if (selectedFile) {
    e.preventDefault();
    e.returnValue = '';  // í¬ë¡¬/ì‚¬íŒŒë¦¬ì—ì„œ ê¸°ë³¸ ê²½ê³ 
  }
});

document.getElementById('deletePhotoBtn').addEventListener('click', async function() {
  if (!confirm('ì •ë§ í”„ë¡œí•„ ì‚¬ì§„ì„ ê¸°ë³¸ ì´ë¯¸ì§€ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  try {
    const res = await fetch('/api/delete-profile-photo', {
      method: 'DELETE',
      credentials: 'include'
    });
    const result = await res.json();
    if (result.success) {
      document.getElementById('profileAvatar').src = '/icon_my_b.png';
      alert('í”„ë¡œí•„ ì‚¬ì§„ì´ ê¸°ë³¸ ì´ë¯¸ì§€ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
      selectedFile = null;
      document.getElementById('savePhotoBtn').style.display = 'none';
    } else {
      alert('í”„ë¡œí•„ ì‚¬ì§„ ì‚­ì œ ì‹¤íŒ¨!');
    }
  } catch (err) {
    alert('ì‚­ì œ ì˜¤ë¥˜: ' + err);
  }
});

/* ê³µí†µ ìœ í‹¸ â€“ ìƒˆ src ê°€ ì ìš©ë¼ ì´ë¯¸ì§€ê°€ ì™„ì „íˆ ë¡œë“œë˜ë©´ í˜ì´ë“œ-ì¸ */
function fadeInAvatar() {
  const av = document.getElementById('profileAvatar');
  av.classList.remove('fade-in');        // ì¬ì‚¬ìš© ëŒ€ë¹„ ë¨¼ì € ì œê±°
  requestAnimationFrame(()=> av.classList.add('fade-in'));
}

/* (1) ì´ˆê¸° í”„ë¡œí•„ ì„¸íŒ… */
const av = document.getElementById('profileAvatar');
av.onload = fadeInAvatar;                // â­ ì´ë¯¸ì§€ê°€ ë¡œë“œë  ë•Œë§ˆë‹¤ ì‹¤í–‰

/* (2) ì„œë²„ì—ì„œ ì‹¤ì œ ì‚¬ì§„ì„ ê°€ì ¸ì˜¬ ë•Œ */
preload.onload = () => { av.src = u.avatarUrl; }   // ê¸°ì¡´ ì½”ë“œ OK â€“ onloadê°€ ìë™ í˜¸ì¶œë˜ì–´ í˜ì´ë“œ-ì¸

/* (3) íŒŒì¼ ì„ íƒ(ë¯¸ë¦¬ë³´ê¸°) */
reader.onload = function(evt){
  av.src = evt.target.result;            // onload ì´ë²¤íŠ¸ê°€ ë˜ ë°œìƒ â†’ í˜ì´ë“œ-ì¸
};

/* (4) ê¸°ë³¸ ì´ë¯¸ì§€ë¡œ ë˜ëŒë¦´ ë•Œ */
document.getElementById('deletePhotoBtn').addEventListener('click', async()=>{
  /* â€¦ì‚­ì œ ë¡œì§â€¦ */
  av.src = '/icon_my_b.png';             // ì—­ì‹œ onload â†’ í˜ì´ë“œ-ì¸
});

document.getElementById('academy-address-save').onclick = async () => {
  const addr = document.getElementById('mem-academy-address-input').value.trim();
  if (!addr) return alert('ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
  try {
    const res = await fetch('/api/save-academy-address', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ address: addr })
    });
    const d = await res.json();
    if (d.success) {
      document.getElementById('mem-academy-address').textContent = addr;
      alert('ì£¼ì†Œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    } else {
      alert('ì €ì¥ ì‹¤íŒ¨');
    }
  } catch (e) {
    alert('ì˜¤ë¥˜ ë°œìƒ');
  }
};


</script>
</body>
</html>
