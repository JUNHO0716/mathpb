<!DOCTYPE html>
<html lang="ko">
<head>
  <meta name="robots" content="noindex, nofollow">
  <meta charset="UTF-8" />
  <title>ìë£Œ ê´€ë¦¬(ê´€ë¦¬ì)</title>
  <link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:700,400&display=swap" rel="stylesheet">
  <style>
    body { background: #f5f5f7; font-family: 'Noto Sans KR', Arial, sans-serif; }

    /* ì œëª©ì€ ì „ì²´ í­ ê¸°ì¤€ìœ¼ë¡œ */
    h2 {
      max-width: 1480px;
      margin: 40px auto 16px;
      text-align: left;
      font-size: 1.48rem;  /* ê¸€ì”¨ ì•½ê°„ ì¶•ì†Œ */
      font-weight: 900;
      color: #181818;
      letter-spacing: -2px;
    }

    /* ===== ì»¤ë²„ë¦¬ì§€ ìš”ì•½ ì˜ì—­ ===== */
    .cov-section {
      max-width: 1480px;          /* ë°•ìŠ¤ ë°–ìœ¼ë¡œ ë¹¼ë„ ê°€ìš´ë° ì •ë ¬ */
      margin: 0 auto 22px;
      padding: 12px 16px 16px 16px;
      border-radius: 18px;
      background: #f7f8ff;
      border: 1px solid #e2e5ff;
    }

    .cov-filter-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 12px;
    }
    .cov-filter-left {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
    .cov-filter-right {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .cov-filter-row select {
      background: #ffffff;
      border-radius: 999px;
      border: 1px solid #dde1ff;
      padding: 6px 12px;
      font-size: 0.8rem;   /* ê¸€ì”¨ í¬ê¸° â†“ */
      min-width: 90px;
      color: #111827;
      outline: none;
      transition: border 0.13s, box-shadow 0.13s;
    }
    .cov-filter-row select:focus {
      border-color: #4b7cff;
      box-shadow: 0 0 0 1px #4b7cff33;
    }

    .cov-summary {
      display: grid;
      grid-template-columns: repeat(6, minmax(0, 1fr)); /* í•œ ì¤„ì— 6ì¹¸, ì¢Œìš° ê½‰ ì°¨ê²Œ */
      gap: 10px;
      align-items: stretch;
    }

    /* í™”ë©´ í­ ì¤„ì–´ë“¤ ë•Œ ì—´ ê°œìˆ˜ ì¡°ì ˆ (ë°˜ì‘í˜•) */
    @media (max-width: 1400px) {
      .cov-summary { grid-template-columns: repeat(5, minmax(0, 1fr)); }
    }
    @media (max-width: 1200px) {
      .cov-summary { grid-template-columns: repeat(4, minmax(0, 1fr)); }
    }
    @media (max-width: 900px) {
      .cov-summary { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }
    @media (max-width: 640px) {
      .cov-summary { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    .cov-card {
      width: 90%;          /* ê·¸ë¦¬ë“œ ì¹¸ ë„ˆë¹„ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš© */
      min-width: 0;
      background: #ffffff;
      border-radius: 16px;
      padding: 10px 12px 11px 12px;
      box-shadow: 0 4px 12px rgba(31, 41, 68, 0.06);
      border: 1px solid transparent;
      cursor: pointer;
      transition: box-shadow .15s, transform .12s, border-color .15s, background .15s;
    }
    .cov-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(31, 41, 68, 0.09);
    }
    .cov-card.cov-card-selected {
      border-color: #4b7cff;
      box-shadow: 0 0 0 1px rgba(75, 124, 255, 0.4), 0 8px 20px rgba(53, 86, 182, 0.18);
      background: linear-gradient(135deg, #f5f7ff, #f9fffb);
    }
    .cov-card-top {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
      gap: 6px;
    }
    .cov-city {
      font-size: 0.92rem;
      font-weight: 700;
      color: #111827;
      letter-spacing: -0.03em;
    }
    .cov-pct {
      font-size: 0.92rem;
      font-weight: 700;
      color: #4b7cff;
    }
    .cov-bar {
      position: relative;
      width: 100%;
      height: 7px;
      border-radius: 999px;
      background: #eef0ff;
      overflow: hidden;
      margin-bottom: 4px;
    }
    .cov-bar-inner {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 0;
      border-radius: 999px;
      background-image: linear-gradient(90deg, #4b7cff, #6ee7b7);
      transition: width 0.25s ease-out;
    }
    .cov-count {
      font-size: 0.78rem;
      color: #6b7280;
    }
    .cov-loading, .cov-empty, .cov-error {
      font-size: 0.9rem;
      color: #6b7280;
    }

    .search-bar {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
      justify-content: flex-end;
      align-items: center;
      flex-wrap: wrap;
    }

    /* ì•„ë˜ ë¦¬ìŠ¤íŠ¸ í•„í„°ë„ ìœ„ ì»¤ë²„ë¦¬ì§€ í•„í„°ì²˜ëŸ¼ ë™ê·¸ë€ í°ìƒ‰ ì…€ë ‰íŠ¸ë¡œ */
    .search-bar select,
    .search-bar input {
      background: #ffffff;
      border-radius: 999px;
      border: 1px solid #dde1ff;
      padding: 6px 12px;
      font-size: 0.8rem;
      color: #111827;
      outline: none;
      transition: border 0.13s, box-shadow 0.13s;
      min-width: 82px;
      margin-bottom: 3px;
    }

    .search-bar select {
      background: #ffffff;
      border-radius: 999px;
      border: 1px solid #dde1ff;
      padding: 6px 12px;
      font-size: 0.8rem;
      color: #111827;
      outline: none;
      min-width: 90px;
      margin-bottom: 3px;
    }

    .search-bar select:focus,
    .search-bar input:focus {
      border-color: #4b7cff;
      box-shadow: 0 0 0 1px #4b7cff33;
      background: #ffffff;
    }

    .search-bar input[type="number"] {
      width: 70px;
      min-width: 60px;
    }

    .search-bar button {
      background: #1a73ff;          /* ì§„í•œ íŒŒë€ìƒ‰ */
      color: #ffffff;
      border-radius: 999px;
      border: none;
      padding: 7px 22px;
      font-size: 0.86rem;
      font-weight: 700;
      cursor: pointer;
      margin-bottom: 3px;
      box-shadow: 0 2px 8px rgba(26, 115, 255, 0.35);
      letter-spacing: 0.02em;
      transition: background 0.15s, box-shadow 0.15s, transform 0.05s;
    }
    /* ì´ˆê¸°í™” ë²„íŠ¼ (ë§ˆì§€ë§‰ ë²„íŠ¼)ë§Œ ì—°í•œ íšŒìƒ‰í†¤ìœ¼ë¡œ */
    .search-bar button:last-child {
      margin-left: 4px;
      background: #f3f4f6;
      color: #374151;
      border: 1px solid #e5e7eb;
      box-shadow: none;
      font-weight: 600;
    }
    .search-bar button:hover {
      background: #1664e4;
      box-shadow: 0 3px 10px rgba(22, 100, 228, 0.4);
    }
    .search-bar button:last-child:hover {
      background: #e5e7eb;
      box-shadow: 0 1px 4px rgba(148, 163, 184, 0.4);
    }
    .search-bar button:active {
      transform: translateY(1px);
      box-shadow: 0 0 0 rgba(0,0,0,0.2);
    }

    .msg { text-align: left; margin: 4px 0 6px; font-size: 0.95rem; color: #555; }

    .files-table-wrap {
      background: #ffffff;
      border-radius: 18px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
      overflow: hidden;
    }

    .files-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: auto;       /* ë‚´ìš©ì— ë§ê²Œ ìë™ í­ ì¡°ì ˆ */
      font-size: 0.95rem;
    }

    /* ìƒë‹¨ í—¤ë”: ì—°í•œ íšŒìƒ‰ ë°” + ì–‡ì€ êµ¬ë¶„ì„  */
    .files-table thead {
      background: #f9fafb;
    }

    .files-table thead th {
      padding: 9px 12px;
      color: #6b7280;              /* ì—°í•œ íšŒìƒ‰ í…ìŠ¤íŠ¸ */
      font-weight: 600;
      font-size: 0.9rem;
      letter-spacing: 0.02em;
      text-align: center;          /* ê°€ìš´ë° ì •ë ¬ */
      border-bottom: 1px solid #e5e7eb;
      white-space: nowrap;
    }

    .files-table tbody td {
      padding: 10px 12px;
      border-bottom: 1px solid #eef2f7;
      text-align: center;   /* ê°€ìš´ë° ì •ë ¬ë¡œ ë³€ê²½ */
      color: #111827;
      background: #ffffff;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .files-table tbody tr:last-child td {
      border-bottom: none;
    }

    .files-table tbody tr:hover td {
      background: #f9fafb;         /* ì‚´ì§ íšŒìƒ‰ í•˜ì´ë¼ì´íŠ¸ */
    }

    /* ì—´ë³„ë¡œ ì¡°ê¸ˆì”© í­ ê°€ì¤‘ì¹˜ (ê°€ë¡œí­ ë„ˆë¬´ ê¸¸ì§€ ì•Šê²Œ ë¹„ìœ¨ë§Œ ì¡°ì ˆ) */
    .files-table th:nth-child(1),
    .files-table td:nth-child(1) { width: 8%; }   /* ì§€ì—­ */
    .files-table th:nth-child(2),
    .files-table td:nth-child(2) { width: 9%; }   /* êµ¬/êµ° */
    .files-table th:nth-child(3),
    .files-table td:nth-child(3) { width: 14%; }  /* í•™êµ */
    .files-table th:nth-child(4),
    .files-table td:nth-child(4) { width: 6%; }   /* í•™ë…„ */
    .files-table th:nth-child(5),
    .files-table td:nth-child(5) { width: 7%; }   /* ì—°ë„ */
    .files-table th:nth-child(6),
    .files-table td:nth-child(6) { width: 7%; }   /* í•™ê¸° */
    .files-table th:nth-child(7),
    .files-table td:nth-child(7) { width: 8%; }   /* ì¤‘ê°„/ê¸°ë§ */
    .files-table th:nth-child(8),
    .files-table td:nth-child(8) { width: 20%; }  /* ì œëª© */
    .files-table th:nth-child(9),
    .files-table td:nth-child(9),
    .files-table th:nth-child(10),
    .files-table td:nth-child(10),
    .files-table th:nth-child(11),
    .files-table td:nth-child(11) { width: 7%; }  /* í•œê¸€/PDF/ê´€ë¦¬ */

    /* í•„ìš”í•˜ë©´ ì„¸ë¡œ ìŠ¤í¬ë¡¤: í–‰ ë§ì„ ë•Œë§Œ ì•ˆì—ì„œ ìŠ¤í¬ë¡¤ */
    .files-table-wrap {
      max-height: 360px;
      overflow-y: auto;
    }


    /* ë‹¤ìš´ë¡œë“œ ì•„ì´ì½˜ ë²„íŠ¼ */
    .download-btn {
      background: transparent;
      border: none;
      padding: 0;
      cursor: pointer;
      margin: 0 2px;
      text-decoration: none;
      display: inline-block;
    }
    .download-btn:hover {
      transform: scale(1.05);
    }
    .download-btn img {
      width: 22px;
      height: auto;
      display: block;
      margin: 0 auto;
    }

    /* ìˆ˜ì • ë²„íŠ¼: íšŒìƒ‰ ìº¡ìŠ */
    .edit-btn {
      background: #f3f4f6;          /* ì—°í•œ íšŒìƒ‰ */
      color: #111827;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 4px 16px;
      cursor: pointer;
      font-size: 0.82rem;
      font-weight: 700;
      margin: 0 2px;
      letter-spacing: 0.02em;
      min-width: 60px;
      box-shadow: 0 2px 6px rgba(148, 163, 184, 0.35);
      transition: background 0.15s, box-shadow 0.15s, transform 0.05s, color 0.15s;
    }

    /* ì‚­ì œ ë²„íŠ¼: ë¹¨ê°„ ìº¡ìŠ ê·¸ëŒ€ë¡œ ìœ ì§€ */
    .delete-btn {
      background: #f97373;          /* ì—°í•œ ë¹¨ê°„ ëŠë‚Œ */
      color: #ffffff;
      border-radius: 999px;
      border: none;
      padding: 4px 16px;
      cursor: pointer;
      font-size: 0.82rem;
      font-weight: 700;
      margin: 0 2px;
      letter-spacing: 0.02em;
      min-width: 60px;
      box-shadow: 0 2px 8px rgba(220, 38, 38, 0.35);
      transition: background 0.15s, box-shadow 0.15s, transform 0.05s;
    }

    .edit-btn:hover {
      background: #e5e7eb;          /* ì‚´ì§ ì§„í•œ íšŒìƒ‰ */
      box-shadow: 0 3px 9px rgba(148, 163, 184, 0.45);
    }
    .delete-btn:hover {
      background: #dc2626;
      box-shadow: 0 3px 10px rgba(220, 38, 38, 0.45);
    }

    .delete-btn:disabled,
    .edit-btn:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      box-shadow: none;
    }


    /* í•˜ë‹¨ íŒŒì¼ ê´€ë¦¬ 2íŒ¨ë„ ë ˆì´ì•„ì›ƒ */
    .admin-main {
      max-width: 1480px;
      margin: 0 auto 40px;
      display: grid;
      /* ì™¼ìª½(í…Œì´ë¸”) ë” ë„“ê²Œ, ì˜¤ë¥¸ìª½(ìƒì„¸) ë” ì¢ê²Œ */
      grid-template-columns: minmax(0, 8fr) minmax(260px, 2.8fr);
      gap: 20px;
      align-items: flex-start;
    }

    .files-panel-left,
    .files-panel-right {
      min-width: 0;
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
      padding: 16px 18px 18px 18px;
    }

    /* ì˜¤ë¥¸ìª½ ìƒì„¸ íŒ¨ë„ ìŠ¤íƒ€ì¼ */
    .file-detail-title {
      margin: 0 0 10px 0;
      font-size: 1.02rem;
      font-weight: 700;
      color: #111827;
    }

    .file-detail-empty {
      font-size: 0.9rem;
      color: #6b7280;
      line-height: 1.6;
      text-align: center;
      padding: 40px 6px;
    }

    .file-detail-body {
      font-size: 0.9rem;
      color: #111827;
    }

    /* ìƒì„¸ ìƒë‹¨ ì¢Œì¸¡: ë©”ëª¨ ì „ì²´ë³´ê¸° ë²„íŠ¼ ì˜ì—­ */
    .file-detail-topbar {
      display: flex;
      justify-content: flex-start;
      margin-bottom: 12px;
    }

    .memo-all-btn {
      padding: 5px 12px;
      font-size: 0.8rem;
      font-weight: 600;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #e5edff;
      color: #1d4ed8;
      box-shadow: 0 1px 4px rgba(37, 99, 235, 0.25);
      transition: background 0.15s, box-shadow 0.15s, transform 0.05s;
    }

    .memo-all-btn:hover {
      background: #d4e3ff;
      box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3);
      transform: translateY(1px);
    }

    /* ë¼ë²¨ / ê°’ í•œ ì¤„ë¡œ í‘œì‹œ */
    .file-detail-row {
      margin-bottom: 20px;           /* ê° ì¤„ ì‚¬ì´ ê°„ê²© */
      display: flex;
      align-items: flex-start;
    }

    /* ì™¼ìª½ ë¼ë²¨ (ì§€ì—­ / í•™êµ, ì—°ë„ / í•™ë…„ / í•™ê¸° / êµ¬ë¶„ ë“±) */
    .file-detail-row span {
      flex: 0 0 auto;
      min-width: 130px;              /* ë¼ë²¨ ì˜ì—­ ê³ ì • í­ */
      padding-right: 12px;
      font-size: 0.78rem;
      color: #9ca3af;
      margin-bottom: 0;              /* ì•„ë˜ ì—¬ë°± ì œê±° */
    }

    /* ì˜¤ë¥¸ìª½ ê°’ ë¶€ë¶„ */
    .file-detail-row strong,
    .file-detail-row p {
      flex: 1;
      line-height: 1.6;
      text-align: right;             /* ê°’ì€ ì˜¤ë¥¸ìª½ ì •ë ¬ (ìœˆë„ìš° ìŠ¤íƒ€ì¼) */
    }

    .file-detail-row strong {
      font-weight: 600;
    }

    .file-detail-row p {
      margin: 0;
      white-space: pre-wrap;
    }

    /* ë©”ëª¨ í–‰: "ë©”ëª¨" ë¼ë²¨ ìœ„, ì•„ë˜ì— ì¹´ë“œê°€ ê¸¸ê²Œ ìŒ“ì´ë„ë¡ ì„¸ë¡œ ë°°ì¹˜ */
    .file-detail-row.memo-row {
      flex-direction: column;    /* ë¼ë²¨ ìœ„, ë©”ëª¨ë¦¬ìŠ¤íŠ¸ ì•„ë˜ë¡œ */
      align-items: stretch;      /* í­ 100% */
    }

    /* ë©”ëª¨ í–‰ì—ì„œë§Œ ë¼ë²¨ì€ í•œ ì¤„ ì“°ê³ , ì•„ë˜ì— ì—¬ë°±ë§Œ ì‚´ì§ */
    .file-detail-row.memo-row > span {
      min-width: 0;
      padding-right: 0;
      margin-bottom: 6px;
    }


    /* ë©”ëª¨ ì „ì²´ ë¦¬ìŠ¤íŠ¸ */
    .memo-list {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;           /* ë©”ëª¨ë¼ë¦¬ ê°„ê²© */
    }

    /* ë©”ëª¨ 1ê°œ ì¹´ë“œ */
    .memo-item {
      padding: 10px 12px;
      border-radius: 10px;
      background: #f7f7fb;
      border: 1px solid #eef0f5;
    }

    /* ë©”ëª¨ ìƒë‹¨ ì˜ì—­(ì‘ì„±ì/ì´ë©”ì¼, ë‚ ì§œ) */
    .memo-meta {
      display: flex;
      justify-content: space-between; /* ì™¼ìª½: ì•„ì´ë””/ì´ë¦„/ë©”ì¼, ì˜¤ë¥¸ìª½: ë‚ ì§œ */
      align-items: center;            /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
      gap: 8px;                       /* ë„ˆë¬´ ë¶™ì§€ ì•Šê²Œ ì•½ê°„ ê°„ê²© */
      margin-bottom: 4px;
    }

    /* ì‘ì„±ì / ì´ë©”ì¼ ë¬¶ìŒ */
    .memo-author-wrap {
      display: flex;
      flex-direction: column;
    }

    /* ì•„ì´ë””(ì´ë¦„) â€“ ê¸€ì”¨ ì¡°ê¸ˆ ì‘ê²Œ */
    .memo-author {
      font-weight: 600;
      font-size: 0.85rem;   /* â†“ ê¸°ì¡´ë³´ë‹¤ ì‚´ì§ ì¤„ì„ */
    }

    /* ì´ë©”ì¼ (íšŒìƒ‰, ì‘ê²Œ) */
    .memo-email {
      font-size: 12px;
      color: #9b9b9b;
    }

    /* ì‘ì„±ì¼ (ì˜¤ë¥¸ìª½ ë) */
    .memo-date {
      font-size: 12px;
      color: #9b9b9b;
    }

    /* ë©”ëª¨ ë‚´ìš© */
    .memo-content {
      font-size: 14px;
      line-height: 1.5;
      white-space: pre-wrap;
    }

    /* ë©”ëª¨ ì—†ì„ ë•Œ ë¬¸êµ¬ */
    .memo-empty {
      font-size: 14px;
      color: #9b9b9b;
      margin: 0;
    }

    /* === íŒŒì¼ ìƒì„¸ ìƒë‹¨ ì•„ì´ì½˜ + íŒŒì¼ëª… í—¤ë” (ìœˆë„ìš° ìŠ¤íƒ€ì¼) === */
    .file-detail-header {
      margin: 30px 0 24px 0;   /* ì•„ë˜ ì—¬ë°± 50px â†’ 24px */
    }

    /* ìœ„ì˜ í° ì•„ì´ì½˜ (ë°°ê²½ ì—†ì´ PNGë§Œ) */
    .file-detail-icon-large {
      text-align: center;
      margin-bottom: 16px;
      margin: 50px 0 70px 0; 
    }
    .file-detail-icon-large img {
      width: 85px;       /* í° ì•„ì´ì½˜ í¬ê¸° */
      height: auto;
      display: inline-block;
    }

    /* ì•„ë˜ ì‘ì€ ì•„ì´ì½˜ + íŒŒì¼ëª… ì¤„ */
    .file-detail-name-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
    }

    .file-detail-name-row img {
      width: 20px;       /* ì‘ì€ ì•„ì´ì½˜ í¬ê¸° */
      height: auto;
      flex-shrink: 0;
      display: block;
    }

    .file-detail-filename {
      margin-top: 0;
      font-size: 0.95rem;
      font-weight: 700;
      color: #111827;
      word-break: break-all;
      text-align: left;
    }

    /* íŒŒì¼ëª… ì•„ë˜ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì¤„ */
    .file-detail-download-row {
      margin-top: 18px;   /* â† 8px â†’ 18px ì •ë„ë¡œ ë„‰ë„‰í•˜ê²Œ */
      display: flex;
      gap: 8px;
    }

    .detail-download-btn {
      border-radius: 8px;
      padding: 4px 12px;          /* â† ì„¸ë¡œÂ·ê°€ë¡œ íŒ¨ë”© ì¤„ì„ */
      font-size: 0.78rem;         /* â† ê¸€ì”¨ë„ ì‚´ì§ ì¤„ì„ */
      font-weight: 700;
      color: #ffffff;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 1px 4px rgba(15, 23, 42, 0.25); /* ê·¸ë¦¼ìë„ ì¡°ê¸ˆ ì•½í•˜ê²Œ */
      transition: transform 0.05s, box-shadow 0.15s, opacity 0.1s;
    }

    .detail-download-btn.pdf {
      background: #ef4444; /* ë¹¨ê°„ìƒ‰(PDF) */
      box-shadow: 0 2px 8px rgba(239, 68, 68, 0.45);
    }

    .detail-download-btn.hwp {
      background: #2563eb; /* íŒŒë€ìƒ‰(HWP) */
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.45);
    }

    .detail-download-btn:hover {
      transform: translateY(1px);
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.35);
    }



    /* ë°˜ì‘í˜•: í™”ë©´ ì¢ì•„ì§€ë©´ 1ì—´ë¡œ ìŒ“ê¸° */
    @media (max-width: 1200px) {
      .admin-main {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 950px) {
      .search-bar {
        flex-direction: column;
        gap: 4px;
        align-items: stretch;
      }
      .files-table,
      .files-table th,
      .files-table td {
        font-size: 0.89rem;
      }
      .files-table th,
      .files-table td {
        padding: 4px 2px;
      }
    }

    /* === ìˆ˜ì • ëª¨ë‹¬ ì „ì²´ ë ˆì´ì•„ì›ƒ (ë†’ì´ â†“, íŒŒë€ í†¤) === */
    #edit-bg {
      display: none;
      position: fixed;
      inset: 0;
      background: #11182788;
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    #edit-bg .modal-box {
      background: #ffffff;
      border-radius: 20px;
      box-shadow: 0 14px 40px rgba(15, 23, 42, 0.35);
      width: 360px;       /* 420 â†’ 360 ìœ¼ë¡œ ê°€ë¡œí­ ì¤„ì´ê¸° */
      max-width: 92vw;    /* ëª¨ë°”ì¼ì—ì„œë„ ì‚´ì§ ë” ì—¬ìœ  ìˆê²Œ */
      max-height: 80vh;
      padding: 18px 18px 14px;  /* ì¢Œìš° íŒ¨ë”©ë„ ì¡°ê¸ˆ ì¤„ì„ */
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      overflow-y: auto;
    }


    #edit-bg .modal-box h3 {
      margin: 0 0 18px 0;
      text-align: center;
      font-size: 1.05rem;
      font-weight: 800;
      color: #111827;
      letter-spacing: -0.06em;
    }

    /* í•„ë“œ ê°„ ê°„ê²© ì‚´ì§ ì¤„ì´ê¸° */
    #edit-bg .modal-box form {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* === í•„í„° ìŠ¤íƒ€ì¼: ê¸°ë³¸ì€ ì–‡ì€ íŒŒë€ ë¼ì¸, í¬ì»¤ìŠ¤ ì‹œ ìº¡ìŠ ê°•ì¡° === */
    #edit-bg .modal-box select,
    #edit-bg .modal-box input[type="text"],
    #edit-bg .modal-box input[type="number"] {
      width: 100%;
      border-radius: 14px;
      border: 1px solid #d2ddff;       /* ì˜…ì€ íŒŒë€ìƒ‰ ë¼ì¸ */
      background: #f8f9ff;             /* ì˜…ì€ íŒŒë€ ë°°ê²½ */
      padding: 8px 12px;
      font-size: 0.92rem;
      outline: none;
      margin-bottom: 0;
      box-shadow: none;
      transition:
        border-color 0.16s ease,
        box-shadow   0.16s ease,
        background   0.16s ease,
        transform    0.08s ease;
      color: #111827;
    }

    /* placeholder í†¤ ì‚´ì§ ì—°í•˜ê²Œ */
    #edit-bg .modal-box input::placeholder {
      color: #9ca3af;
    }

    /* í¬ì»¤ìŠ¤(ì‹¤ì œë¡œ ë°”ê¾¸ëŠ” í•„í„°) â†’ ì´ë¯¸ì§€ ê°€ìš´ë° í•„í„°ì²˜ëŸ¼ íŒŒë€ ìº¡ìŠ ëŠë‚Œ */
    #edit-bg .modal-box select:focus,
    #edit-bg .modal-box input[type="text"]:focus,
    #edit-bg .modal-box input[type="number"]:focus {
      border-color: #2563eb;                       /* ì§„í•œ íŒŒë‘ */
      background: #eef4ff;                         /* ì‚´ì§ ë” ì§„í•œ íŒŒë€ ë°°ê²½ */
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.35);
      transform: translateY(-1px);
    }

    /* íŒŒì¼ inputì€ ìˆ¨ê¹€ ìŠ¤íƒ€ì¼ ìœ ì§€ */
    #edit-bg .modal-box input[type="file"] {
      border: none;
      background: none;
      padding: 0;
      font-size: 0.9rem;
      margin-bottom: 0;
    }

    #edit-bg .modal-box > div[style*="font-size:.9rem"] {
      font-size: 0.9rem !important;
      color: #4b5563;
      margin-bottom: 2px;
    }

    /* ëª¨ë‹¬ ë²„íŠ¼ ì˜ì—­ */
    #edit-bg .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 14px;
    }

    /* ëª¨ë‹¬ ë²„íŠ¼ë“¤ â€“ ì¡°ê¸ˆ ë” ì‘ê³  í”Œë«í•˜ê²Œ */
    #edit-bg .modal-box button {
      border: none;
      border-radius: 999px;
      font-size: 0.9rem;
      padding: 7px 18px;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.16s, color 0.13s, box-shadow 0.16s, transform 0.05s;
    }

    /* ì·¨ì†Œ ë²„íŠ¼ */
    #edit-bg .modal-box button[type="button"] {
      background: #f3f4f6;
      color: #374151;
      box-shadow: 0 1px 3px rgba(148, 163, 184, 0.45);
    }
    #edit-bg .modal-box button[type="button"]:hover {
      background: #e5e7eb;
      color: #111827;
      transform: translateY(1px);
    }

    /* ì €ì¥ ë²„íŠ¼ â€“ íŒŒë€ìƒ‰ */
    #edit-bg .modal-box button[type="submit"] {
      background: #2563eb;
      color: #ffffff;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.45);
    }
    #edit-bg .modal-box button[type="submit"]:hover {
      background: #1d4fd8;
      transform: translateY(1px);
    }

    /* === íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ë„ ë…¸ë‘ â†’ íŒŒë‘ ê³„ì—´ë¡œ í†µì¼ === */
    .file-upload-area {
      border: 2px dashed #c7d2fe;
      background: #f5f7ff;
      border-radius: 14px;
      padding: 20px 14px 14px;
      text-align: center;
      margin: 10px 0 6px 0;
      transition: border-color 0.15s, background 0.15s;
      position: relative;
      min-height: 70px;
    }
    .file-upload-area.dragover {
      border-color: #2563eb;
      background: #eef4ff;
    }

    #fileSelectBtn {
      background: #2563eb;
      color: #ffffff;
      border: none;
      border-radius: 999px;
      padding: 8px 26px;
      font-size: 0.9rem;
      font-weight: 700;
      margin-bottom: 8px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.45);
      transition: background 0.15s, color 0.13s, transform 0.05s, box-shadow 0.15s;
    }
    #fileSelectBtn:hover {
      background: #1d4fd8;
      transform: translateY(1px);
    }

    #fileUploadText {
      color: #4b5563;
      font-size: 0.9rem;
      margin: 0 0 8px 0;
      font-family: inherit;
    }

    #fileList {
      margin-top: 2px;
      color: #1f2937;
      font-size: 0.86rem;
      min-height: 18px;
      text-align: left;
      display: flex;
      flex-wrap: wrap;
      gap: 5px 10px;
      justify-content: center;
    }

    .file-item {
      background: #eef2ff;
      border-radius: 999px;
      border: 1px solid #c7d2fe;
      padding: 3px 10px;
      font-size: 0.84rem;
      color: #1f2937;
      margin-bottom: 1px;
    }

  </style>
</head>
<body>
  <!-- ì œëª©ì€ ë°”ê¹¥ìœ¼ë¡œ ë¶„ë¦¬ -->
  <h2>ìë£Œ ê´€ë¦¬ (ê´€ë¦¬ì)</h2>

  <!-- ===== ìƒë‹¨ ì»¤ë²„ë¦¬ì§€ í•„í„° + ì¹´ë“œ (íŒ¨ë„ ë°–ìœ¼ë¡œ ë¶„ë¦¬) ===== -->
  <div class="cov-section">
      <div class="cov-filter-row">
      <div class="cov-filter-left">
        <!-- ì—°ë„ ë¨¼ì € -->
        <select id="cov-year">
          <!-- JSì—ì„œ /api/coverage/years ë¡œ ì±„ì›€ -->
        </select>

        <!-- ê´€(ê³ ë“±/ì¤‘ë“±) -->
        <select id="cov-level">
          <option value="ê³ ë“±">ê³ ë“±</option>
          <option value="ì¤‘ë“±">ì¤‘ë“±</option>
        </select>

        <!-- í•™ë…„ -->
        <select id="cov-grade">
          <option value="">í•™ë…„ ì „ì²´</option>
          <option value="1">1í•™ë…„</option>
          <option value="2">2í•™ë…„</option>
          <option value="3">3í•™ë…„</option>
        </select>

        <!-- í•™ê¸° -->
        <select id="cov-semester">
          <option value="">í•™ê¸° ì „ì²´</option>
          <option value="1">1í•™ê¸°</option>
          <option value="2">2í•™ê¸°</option>
        </select>

        <!-- ì¤‘ê°„/ê¸°ë§ -->
        <select id="cov-exam">
          <option value="">êµ¬ë¶„ ì „ì²´</option>
          <option value="mid">ì¤‘ê°„</option>
          <option value="final">ê¸°ë§</option>
        </select>
      </div>
        <div class="cov-filter-right">
          <select id="cov-sort">
            <option value="pct-desc">% ë†’ì€ìˆœ</option>
            <option value="pct-asc">% ë‚®ì€ìˆœ</option>
            <option value="filled-desc">íŒŒì¼ ë§ì€ìˆœ</option>
            <option value="name">ì§€ì—­ ì´ë¦„ìˆœ</option>
          </select>
        </div>
      </div>

    <div class="cov-summary" id="cov-summary">
      <!-- JSë¡œ ì¹´ë“œ ë Œë”ë§ -->
    </div>
  </div>

  <!-- í•˜ë‹¨ íŒŒì¼ ê´€ë¦¬ 2íŒ¨ë„ ë ˆì´ì•„ì›ƒ -->
  <div class="admin-main">

    <!-- â¬… ì™¼ìª½: íŒŒì¼ ë¦¬ìŠ¤íŠ¸ íŒ¨ë„ -->
    <div class="files-panel-left">

    <!-- ê²€ìƒ‰ë°” -->
    <div class="search-bar">
      <!-- ì—°ë„ (2024, 2025ë§Œ) -->
      <select id="file-year" style="width:110px;">
        <option value="">ì—°ë„ ì „ì²´</option>
        <option value="2024">2024</option>
        <option value="2025">2025</option>
      </select>

      <!-- ê´€(ê³ ë“±/ì¤‘ë“±) -->
      <select id="file-level" style="width:90px;">
        <option value="">ê´€ ì „ì²´</option>
        <option value="ê³ ë“±">ê³ ë“±</option>
        <option value="ì¤‘ë“±">ì¤‘ë“±</option>
      </select>

      <!-- ì§€ì—­ ìë™ ìƒì„± -->
      <select id="file-region" style="width:120px;">
        <option value="">ì§€ì—­ ì „ì²´</option>
      </select>

      <!-- êµ¬/êµ° ìë™ ìƒì„± -->
      <select id="file-district" style="width:120px;">
        <option value="">êµ¬/êµ° ì „ì²´</option>
      </select>

      <!-- í•™êµëª… -->
      <input id="search-school" placeholder="í•™êµëª…" style="width:110px;" />

      <!-- í•™ë…„ -->
      <select id="file-grade" style="width:110px;">
        <option value="">í•™ë…„ ì „ì²´</option>
        <option value="ì¤‘1">ì¤‘1</option>
        <option value="ì¤‘2">ì¤‘2</option>
        <option value="ì¤‘3">ì¤‘3</option>
        <option value="ê³ 1">ê³ 1</option>
        <option value="ê³ 2">ê³ 2</option>
        <option value="ê³ 3">ê³ 3</option>
      </select>

      <!-- í•™ê¸° -->
      <select id="file-semester" style="width:110px;">
        <option value="">í•™ê¸° ì „ì²´</option>
        <option value="1í•™ê¸°">1í•™ê¸°</option>
        <option value="2í•™ê¸°">2í•™ê¸°</option>
      </select>

      <!-- ì¤‘ê°„/ê¸°ë§ -->
      <select id="file-exam" style="width:110px;">
        <option value="">êµ¬ë¶„ ì „ì²´</option>
        <option value="ì¤‘ê°„">ì¤‘ê°„</option>
        <option value="ê¸°ë§">ê¸°ë§</option>
      </select>

      <!-- ê³¼ëª© (ì¤‘ë“±/ê³ ë“±ì— ë”°ë¼ ì˜µì…˜ì´ ë°”ë€œ) -->
      <select id="file-subject" style="width:140px;">
        <option value="">ê³¼ëª© ì „ì²´</option>
      </select>

      <!-- ìë£Œëª… -->
      <input id="search-title"  placeholder="ìë£Œëª…" style="width:130px;" />

      <button onclick="doSearch()">ê²€ìƒ‰</button>
      <button onclick="resetSearch()" style="margin-left:2px;">ì´ˆê¸°í™”</button>
    </div>

      <!-- íŒŒì¼ ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” -->
      <div class="msg" id="msg"></div>

      <div class="files-table-wrap">
        <table class="files-table">
          <thead>
            <tr>
              <th>ì§€ì—­</th>
              <th>êµ¬/êµ°</th>
              <th>í•™êµ</th>
              <th>í•™ë…„</th>
              <th>ì—°ë„</th>
              <th>í•™ê¸°</th>
              <th>ì¤‘ê°„/ê¸°ë§</th>
              <th>ê³¼ëª©</th>   <!-- ì œëª© â†’ ê³¼ëª© -->
              <th>í•œê¸€</th>
              <th>PDF</th>
              <th>ê´€ë¦¬</th>
            </tr>
          </thead>
          <tbody id="file-list"><!-- JSë¡œ ì±„ì›€ --></tbody>
        </table>
      </div>


    </div>

    <!-- â¡ ì˜¤ë¥¸ìª½: ë¬¸ì œ íŒŒì¼ ìƒì„¸ ì •ë³´ íŒ¨ë„ -->
    <div class="files-panel-right">
      <!-- ì œëª© í…ìŠ¤íŠ¸ ì œê±°ë¨ -->

            <!-- ìƒë‹¨ ì¢Œì¸¡: ë©”ëª¨ ì „ì²´ë³´ê¸° ë²„íŠ¼ -->
      <div class="file-detail-topbar">
        <button type="button" id="memo-all-btn" class="memo-all-btn">
          ë©”ëª¨ ì „ì²´ë³´ê¸°
        </button>
      </div>

      <!-- ì•„ì§ ì„ íƒëœ íŒŒì¼ì´ ì—†ì„ ë•Œ -->
      <div id="file-detail-empty" class="file-detail-empty">
        ì™¼ìª½ ëª©ë¡ì—ì„œ íŒŒì¼ì„ ì„ íƒí•˜ë©´<br>ìƒì„¸ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
      </div>

      <!-- íŒŒì¼ ì„ íƒ í›„ ìƒì„¸ ì •ë³´ ì˜ì—­ -->
      <div id="file-detail-body" class="file-detail-body" style="display:none;">

        <div class="file-detail-header">
          <!-- ìœ„ì˜ í° ì•„ì´ì½˜ -->
          <div class="file-detail-icon-large">
            <img id="detail-file-icon-main"
                 src="image_download/pdf_download.png"
                 alt="íŒŒì¼ ì•„ì´ì½˜">
          </div>

          <!-- ì•„ë˜ ì‘ì€ ì•„ì´ì½˜ + íŒŒì¼ëª… (ì™¼ìª½ ì •ë ¬) -->
          <div class="file-detail-name-row">
            <img id="detail-file-icon-small"
                 src="image_download/pdf_download.png"
                 alt="íŒŒì¼ ì•„ì´ì½˜">
            <span class="file-detail-filename" id="detail-file-name">
              íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”
            </span>
          </div>

          <!-- ğŸ”½ íŒŒì¼ëª… ë°”ë¡œ ì•„ë˜ PDF/HWP ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
          <div class="file-detail-download-row">
            <a id="detail-download-pdf"
               href="#"
               class="detail-download-btn pdf"
               style="display:none;">
              PDF
            </a>
            <a id="detail-download-hwp"
               href="#"
               class="detail-download-btn hwp"
               style="display:none;">
              HWP
            </a>
          </div>
        </div>

        <!-- â¬‡ ê¸°ì¡´ ì •ë³´ë“¤ -->
        <div class="file-detail-row">
          <span>ì§€ì—­ / í•™êµ</span>
          <strong id="detail-school">-</strong>
        </div>
        <div class="file-detail-row">
          <span>ì—°ë„ / í•™ë…„ / í•™ê¸° / êµ¬ë¶„</span>
          <strong id="detail-meta-year">-</strong>
        </div>
        <!-- ì œëª©ì€ ìœ„ì—ì„œ ì´ë¯¸ í‘œì‹œë˜ë¯€ë¡œ ìƒì„¸ ì •ë³´ì—ì„œëŠ” ì œê±° -->
        <div class="file-detail-row">
          <span>ê³¼ëª©</span>
          <strong id="detail-subject">-</strong>
        </div>

        <!-- ğŸ†• PDF / HWP ì—…ë¡œë“œì¼ -->
        <div class="file-detail-row">
          <span>PDF ì—…ë¡œë“œì¼</span>
          <strong id="detail-pdf-date">-</strong>
        </div>
        <div class="file-detail-row">
          <span>HWP ì—…ë¡œë“œì¼</span>
          <strong id="detail-hwp-date">-</strong>
        </div>

        <div class="file-detail-row memo-row">
          <span>ë©”ëª¨</span>
          <!-- ì—¬ëŸ¬ ê°œ ë©”ëª¨ê°€ ìŒ“ì´ëŠ” ì˜ì—­ -->
          <div id="detail-memo-list" class="memo-list">
            <p class="memo-empty">ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
          </div>
        </div>
      </div>
    </div>

  </div> <!-- /.admin-main -->


  <!-- ==== ê¸°ì¡´ ìˆ˜ì • ëª¨ë‹¬ / í”„ë¦¬ë·° ==== -->
  <div id="edit-bg">
    <div class="modal-box">
      <h3 style="margin-top:0">ìë£Œ ì •ë³´ ìˆ˜ì •</h3>
      <form id="edit-form" enctype="multipart/form-data">
        <!-- ê´€ (ì¤‘ë“± / ê³ ë“±) -->
        <select name="level" required>
          <option value="">ê´€ ì„ íƒ</option>
          <option value="ì¤‘ë“±">ì¤‘ë“±</option>
          <option value="ê³ ë“±">ê³ ë“±</option>
        </select>

        <!-- ì§€ì—­: ì»¤ë²„ë¦¬ì§€ì—ì„œ ë°›ì•„ì˜¤ëŠ” ë“œë¡­ë‹¤ìš´ (JSì—ì„œ ì±„ì›€) -->
        <select name="region" required>
          <option value="">ì§€ì—­ ì„ íƒ</option>
        </select>

        <!-- êµ¬/êµ°: ì»¤ë²„ë¦¬ì§€ì—ì„œ ë°›ì•„ì˜¤ëŠ” ë“œë¡­ë‹¤ìš´ (JSì—ì„œ ì±„ì›€) -->
        <select name="district" required>
          <option value="">êµ¬/êµ° ì„ íƒ</option>
        </select>

        <!-- í•™êµ ì´ë¦„: ì§ì ‘ ìˆ˜ì • ê°€ëŠ¥ -->
        <input name="school" placeholder="í•™êµ ì´ë¦„" required />

        <!-- í•™ë…„: ê¸°ì¡´ í˜ì´ì§€ í•„í„°ì™€ ë™ì¼ -->
        <select name="grade" required>
          <option value="">í•™ë…„ ì„ íƒ</option>
          <option>ì¤‘1</option>
          <option>ì¤‘2</option>
          <option>ì¤‘3</option>
          <option>ê³ 1</option>
          <option>ê³ 2</option>
          <option>ê³ 3</option>
        </select>

        <!-- ì—°ë„: 2024 / 2025 ë“œë¡­ë‹¤ìš´ -->
        <select name="year" required>
          <option value="">ì—°ë„ ì„ íƒ</option>
          <option value="2024">2024</option>
          <option value="2025">2025</option>
        </select>

        <!-- í•™ê¸°: 1í•™ê¸° / 2í•™ê¸° -->
        <select name="semester" required>
          <option value="">í•™ê¸° ì„ íƒ</option>
          <option value="1í•™ê¸°">1í•™ê¸°</option>
          <option value="2í•™ê¸°">2í•™ê¸°</option>
        </select>

        <!-- êµ¬ë¶„: ì¤‘ê°„ / ê¸°ë§ -->
        <select name="exam_type" required>
          <option value="">êµ¬ë¶„ ì„ íƒ</option>
          <option value="ì¤‘ê°„">ì¤‘ê°„</option>
          <option value="ê¸°ë§">ê¸°ë§</option>
        </select>

        <!-- ìë£Œ ì œëª© -->
        <input name="title" placeholder="ìë£Œ ì œëª©" required />
        <div style="font-size:.9rem;margin:4px 0 2px;">íŒŒì¼ êµì²´(ì„ íƒ)</div>
        <div class="file-upload-area" id="fileDropArea">
          <input type="file" id="fileInput" name="files" multiple hidden />
          <button type="button" id="fileSelectBtn">íŒŒì¼ ì¶”ê°€</button>
          <div id="fileUploadText">ì—¬ê¸°ë¡œ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ <b>íŒŒì¼ ì¶”ê°€</b> ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</div>
          <div id="fileList"></div>
        </div>
        <div class="modal-actions">
          <button type="button" onclick="closeEdit()">ì·¨ì†Œ</button>
          <button type="submit" id="edit-save-btn">ì €ì¥</button>
        </div>
      </form>
    </div>
  </div>
  <script>
    let fileListOrigin = [];
    let editTargetId   = null;

    // ===== ê³¼ëª© í•„í„°ìš© ëª©ë¡ (ì¤‘ë“± / ê³ ë“±) =====
    const SUBJECTS_MIDDLE = [
      'ì¤‘ë“± 1-1 (2022 ê°œì •)',
      'ì¤‘ë“± 1-2 (2022 ê°œì •)',
      'ì¤‘ë“± 2-1 (2022 ê°œì •)',
      'ì¤‘ë“± 2-2 (2022 ê°œì •)',
      'ì¤‘ë“± 3-1 (2022 ê°œì •)',
      'ì¤‘ë“± 1-1',
      'ì¤‘ë“± 1-2',
      'ì¤‘ë“± 2-1',
      'ì¤‘ë“± 2-2',
      'ì¤‘ë“± 3-1',
      'ì¤‘ë“± 3-2'
    ];

    const SUBJECTS_HIGH = [
      'ê³µí†µìˆ˜í•™1 (2022 ê°œì •)',
      'ê³µí†µìˆ˜í•™2 (2022 ê°œì •)',
      'ë¯¸ì ë¶„1 (2022 ê°œì •)',
      'í™•ë¥ ê³¼ í†µê³„ (2022 ê°œì •)',
      'ëŒ€ìˆ˜ (2022 ê°œì •)',
      'ê¸°ì¶œê³¼ì • (2022 ê°œì •)',
      'ìˆ˜í•™(ìƒ)',
      'ìˆ˜í•™(í•˜)',
      'ìˆ˜í•™1',
      'ìˆ˜í•™2',
      'ë¯¸ì ë¶„',
      'í™•ë¥ ê³¼ í†µê³„',
      'ê¸°í•˜'
    ];

    // ê´€(ì¤‘ë“±/ê³ ë“±) ì„ íƒì— ë”°ë¼ ê³¼ëª© ì…€ë ‰íŠ¸ ì˜µì…˜ ê°±ì‹ 
    function updateSubjectOptions() {
      const levelSel   = document.getElementById('file-level');
      const subjectSel = document.getElementById('file-subject');
      if (!subjectSel) return;

      const level = levelSel?.value || '';
      let items = [];

      if (level === 'ì¤‘ë“±') {
        items = SUBJECTS_MIDDLE;
      } else if (level === 'ê³ ë“±') {
        items = SUBJECTS_HIGH;
      } else {
        items = []; // ê´€ ì „ì²´ì¼ ë•ŒëŠ” ê³¼ëª© ëª©ë¡ ë¹„ì›€
      }

      subjectSel.innerHTML =
        '<option value=\"\">ê³¼ëª© ì „ì²´</option>' +
        items.map(s => `<option value="${s}">${s}</option>`).join('');
    }

    const covState = {
      level: 'ê³ ë“±',
      grade: '',
      year: '',
      semester: '',     // '1' | '2'
      examType: '',     // 'mid' | 'final'
      sort: 'pct-desc',
      selectedCity: '',
      view: 'city'      // 'city' = ì‹œ/ë„ ì¹´ë“œ, 'district' = êµ¬/êµ° ì¹´ë“œ
    };
    let covSummaryData = [];

    // ===== ê³µí†µ ìœ í‹¸ =====
    function normalizeGradeNumber(g){
      const m = String(g || '').match(/[1-3]/);
      return m ? m[0] : '';
    }
    function shortCityName(name){
          // ê´‘ì—­ì‹œ / íŠ¹ë³„ì‹œ / íŠ¹ë³„ìì¹˜ì‹œ ì˜ "ì‹œ"ë§Œ ì œê±°í•˜ê³ ,
          // 'ë„' ê³„ì—´ì€ ê·¸ëŒ€ë¡œ ë‘ì–´ì„œ ê°•ì›ë„, ê²½ê¸°ë„ì²˜ëŸ¼ ë³´ì´ê²Œ í•œë‹¤.
          return String(name || '').replace(/(íŠ¹ë³„ìì¹˜ì‹œ|ê´‘ì—­ì‹œ|íŠ¹ë³„ì‹œ)$/,'');
        }

        function shortCityName(name){
          // ìœ„ì™€ ë™ì¼ â€“ í˜¹ì‹œ ì¤‘ë³µ ì •ì˜ëœ ë¶€ë¶„ê¹Œì§€ ëª¨ë‘ ë™ì¼í•˜ê²Œ êµì²´
          return String(name || '').replace(/(íŠ¹ë³„ìì¹˜ì‹œ|ê´‘ì—­ì‹œ|íŠ¹ë³„ì‹œ)$/,'');
        }
        // í•™ê¸°/ì¤‘ê°„Â·ê¸°ë§ í…ìŠ¤íŠ¸ ì¡°í•©
        function formatSemesterCell(r){
          const sem  = (r.semester || '').trim();   // ì˜ˆ: '1í•™ê¸°'
          const exam = (r.exam_type || '').trim();  // ì˜ˆ: 'ì¤‘ê°„', 'ê¸°ë§'
          if (sem && exam) return `${sem} ${exam}`;
          return sem || exam || '';
        }

    // ===== íŒŒì¼ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° =====
    async function fetchFiles(){
      const res  = await fetch('/api/files',{credentials:'include'});
      if(res.status===401){
        alert('ë¡œê·¸ì¸ í•„ìš”!'); location.href='/login.html'; return;
      }
      const list = await res.json();
      fileListOrigin = list || [];
    }

function renderTable(list){
  const tbody = document.getElementById('file-list');
  if(!tbody) return;

  if(!list.length){
    tbody.innerHTML = `<tr><td colspan="11" style="text-align:center;color:#bbb;">ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>`;
    return;
  }

  tbody.innerHTML = list.map(r=>{
    const semesterText = r.semester || '';      // ì˜ˆ: '1í•™ê¸°'
    const examText     = r.exam_type || '';     // ì˜ˆ: 'ì¤‘ê°„', 'ê¸°ë§'

    return `
        <tr onclick="selectFileDetail(${r.id})">
          <td>${r.region   || ''}</td>
          <td>${r.district || ''}</td>
          <td>${r.school   || ''}</td>
          <td>${r.grade    || ''}</td>
          <td>${r.year     || ''}</td>
          <td>${semesterText}</td>
          <td>${examText}</td>
          <td>${r.subject  || ''}</td>   <!-- ì œëª© ëŒ€ì‹  ê³¼ëª© -->
          <td>
            ${r.files && r.files.hwp ? `
              <a href="/api/download/${r.id}?type=hwp" class="download-btn" target="_blank">
                <img src="image_download/hwp_download.png" alt="HWP ë‹¤ìš´ë¡œë“œ ì•„ì´ì½˜">
              </a>
            ` : '-'}
          </td>
          <td>
            ${r.files && r.files.pdf ? `
              <a href="/api/download/${r.id}?type=pdf" class="download-btn" target="_blank">
                <img src="image_download/pdf_download.png" alt="PDF ë‹¤ìš´ë¡œë“œ ì•„ì´ì½˜">
              </a>
            ` : '-'}
          </td>
          <td>
            <button class="edit-btn"   onclick="editFile(${r.id});event.stopPropagation();">ìˆ˜ì •</button>
            <button class="delete-btn" onclick="deleteFile(${r.id},this);event.stopPropagation();">ì‚­ì œ</button>
          </td>
        </tr>`;
  }).join('');
}

// âœ… ìˆ˜ì •í›„
function applyFiltersAndRender(){
  const level    = document.getElementById('file-level')?.value || '';
  const region   = document.getElementById('file-region')?.value || '';
  const district = document.getElementById('file-district')?.value || '';
  const grade    = document.getElementById('file-grade')?.value || '';
  const year     = document.getElementById('file-year')?.value.trim() || '';
  const semester = document.getElementById('file-semester')?.value || '';
  const exam     = document.getElementById('file-exam')?.value || '';
  const subject  = document.getElementById('file-subject')?.value.trim() || '';
  const schoolTxt = document.getElementById('search-school')?.value.trim() || '';
  const titleTxt  = document.getElementById('search-title')?.value.trim() || '';

  const filtered = fileListOrigin.filter(r => {

    if (level   && r.level   !== level) return false;
    if (region  && r.region  !== region) return false;
    if (district && (!r.district || r.district !== district)) return false;
    if (grade   && r.grade   !== grade) return false;

    if (year && String(r.year) !== year) return false;
    if (semester && r.semester !== semester) return false;
    if (exam && r.exam_type !== exam) return false;

    if (subject && (!r.subject || !String(r.subject).includes(subject))) return false;

    if (schoolTxt && (!r.school || !String(r.school).includes(schoolTxt))) return false;
    if (titleTxt  && (!r.title  || !String(r.title).includes(titleTxt))) return false;

    return true;
  });

  renderTable(filtered);
}

    function doSearch(){
      applyFiltersAndRender();
    }
function resetSearch(){
  const school = document.getElementById('search-school');
  const title  = document.getElementById('search-title');
  const semSel  = document.getElementById('file-semester');
  const examSel = document.getElementById('file-exam');

  if (school) school.value = '';
  if (title)  title.value  = '';
  if (semSel) semSel.value = '';
  if (examSel) examSel.value = '';

  // ì»¤ë²„ë¦¬ì§€ í•„í„°ëŠ” ê·¸ëŒ€ë¡œ ë‘ê³ , íŒŒì¼ ë¦¬ìŠ¤íŠ¸ë§Œ ì´ˆê¸°í™”
  applyFiltersAndRender();
}

    async function initCoverageFilters(){
      const levelSel = document.getElementById('cov-level');
      const gradeSel = document.getElementById('cov-grade');
      const yearSel  = document.getElementById('cov-year');
      const sortSel  = document.getElementById('cov-sort');
      const semSel   = document.getElementById('cov-semester');
      const examSel  = document.getElementById('cov-exam');

      if (levelSel) covState.level    = levelSel.value || 'ê³ ë“±';
      if (gradeSel) covState.grade    = gradeSel.value || '';
      if (yearSel)  covState.year     = yearSel.value  || '';
      if (semSel)   covState.semester = semSel.value   || '';
      if (examSel)  covState.examType = examSel.value  || '';
      if (sortSel)  covState.sort     = sortSel.value  || 'pct-desc';

      // ğŸ”½ ì—°ë„ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (/api/coverage/years ê²°ê³¼ ì‚¬ìš©)
      try {
        const res  = await fetch('/api/coverage/years');
        const data = await res.json().catch(() => null);

        let years = [];
        if (data && Array.isArray(data.years) && data.years.length) {
          // ì˜ˆ: [2024, 2025]
          years = data.years;
        } else {
          // í˜¹ì‹œë¼ë„ APIê°€ ë¹„ì–´ ìˆìœ¼ë©´ í˜„ì¬ ê¸°ì¤€ ìµœê·¼ 2ë…„ ì‚¬ìš©
          const cur = new Date().getFullYear();
          years = [cur - 1, cur];
        }

        if (yearSel) {
          yearSel.innerHTML = years
            .map(y => `<option value="${y}">${y}ë…„</option>`)
            .join('');

          const last = years[years.length - 1]; // ê°€ì¥ ìµœê·¼ ì—°ë„ (ì˜ˆ: 2025)
          covState.year = String(last);
          yearSel.value = String(last);
        }
      } catch (e) {
        console.error('[cov-year] load error', e);
        const cur = new Date().getFullYear();
        if (yearSel) {
          yearSel.innerHTML = `<option value="${cur}">${cur}ë…„</option>`;
          yearSel.value = String(cur);
        }
        covState.year = String(cur);
      }

      levelSel?.addEventListener('change', ()=>{
        covState.level = levelSel.value;
        covState.selectedCity = '';
        covState.view = 'city';          // ì§€ì—­ ëª¨ë“œë¡œ ë¦¬ì…‹
        refreshCoverageSummary();
        loadFileFilterRegions();         // íŒŒì¼ ê²€ìƒ‰ìš© ì§€ì—­ ë“œë¡­ë‹¤ìš´ë„ ê°™ì´ ê°±ì‹ 
      });
      gradeSel?.addEventListener('change', ()=>{
        covState.grade = gradeSel.value;
        covState.selectedCity = '';
        covState.view = 'city';
        refreshCoverageSummary();
      });
      yearSel?.addEventListener('change', ()=>{
        covState.year = yearSel.value;
        covState.selectedCity = '';
        covState.view = 'city';
        refreshCoverageSummary();
      });
      semSel?.addEventListener('change', ()=>{
        covState.semester = semSel.value;
        covState.selectedCity = '';
        covState.view = 'city';
        refreshCoverageSummary();
      });
      examSel?.addEventListener('change', ()=>{
        covState.examType = examSel.value;
        covState.selectedCity = '';
        covState.view = 'city';
        refreshCoverageSummary();
      });
      sortSel?.addEventListener('change', ()=>{
        covState.sort = sortSel.value;
        sortCoverageSummary();
        renderCoverageCards();
      });
    }


  async function loadFileFilterRegions() {
    const regionSel = document.getElementById('file-region');
    if (!regionSel) return;

    try {
      // coverage ì§€ì—­ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
      const res = await fetch(`/api/coverage/cities?level=${encodeURIComponent(covState.level)}`);
      const regions = await res.json();

      regionSel.innerHTML = `<option value="">ì§€ì—­ ì „ì²´</option>` +
        regions.map(r => `<option value="${r}">${r}</option>`).join('');
    } catch (e) {
      console.error("ì§€ì—­ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", e);
    }
  }

  async function loadFileFilterDistricts(region) {
    const distSel = document.getElementById('file-district');
    if (!distSel) return;

    if (!region) {
      distSel.innerHTML = `<option value="">êµ¬/êµ° ì „ì²´</option>`;
      return;
    }

    try {
      // coverage.js ì— ë§ê²Œ level + city ë¡œ ì „ë‹¬
      const params = new URLSearchParams();
      if (covState.level) params.append('level', covState.level);
      params.append('city', region);

      const res = await fetch(`/api/coverage/districts?${params.toString()}`);
      let districts = await res.json();

      // ì„œë²„ê°€ { districts:[...] } í˜•íƒœì´ê±°ë‚˜, [{district:'ìˆ˜ì§€êµ¬'}] í˜•íƒœì¼ ìˆ˜ë„ ìˆìœ¼ë‹ˆ ë³´ì •
      if (districts && Array.isArray(districts.districts)) {
        districts = districts.districts;
      }
      if (!Array.isArray(districts)) {
        districts = [];
      }

      distSel.innerHTML =
        `<option value="">êµ¬/êµ° ì „ì²´</option>` +
        districts.map(d => {
          const name =
            typeof d === 'string'
              ? d
              : (d.district || d.name || d.district_name || '');
          return name
            ? `<option value="${name}">${name}</option>`
            : '';
        }).join('');
    } catch (e) {
      console.error("êµ¬êµ° ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", e);
      distSel.innerHTML = `<option value="">êµ¬/êµ° ì „ì²´</option>`;
    }
  }

    // ==== ìˆ˜ì • ëª¨ë‹¬ìš© ì§€ì—­ / êµ¬êµ° ë“œë¡­ë‹¤ìš´ ====
  async function loadEditRegions() {
    const form = document.getElementById('edit-form');
    if (!form) return;

    const regionSel = form.querySelector('select[name="region"]');
    const levelSel  = form.querySelector('select[name="level"]');
    if (!regionSel) return;

    const level = (levelSel?.value || covState.level || '').trim();

    try {
      const qLevel = encodeURIComponent(level || '');
      const res = await fetch(`/api/coverage/cities?level=${qLevel}`);
      const regions = await res.json().catch(() => []);

      regionSel.innerHTML =
        '<option value="">ì§€ì—­ ì„ íƒ</option>' +
        (Array.isArray(regions)
          ? regions.map(r => `<option value="${r}">${r}</option>`).join('')
          : '');
    } catch (e) {
      console.error('edit-region load error:', e);
      regionSel.innerHTML = '<option value="">ì§€ì—­ ì„ íƒ</option>';
    }
  }

  async function loadEditDistricts(region) {
    const form = document.getElementById('edit-form');
    if (!form) return;

    const districtSel = form.querySelector('select[name="district"]');
    const levelSel    = form.querySelector('select[name="level"]');
    if (!districtSel) return;

    if (!region) {
      districtSel.innerHTML = '<option value="">êµ¬/êµ° ì„ íƒ</option>';
      return;
    }

    try {
      const params = new URLSearchParams();
      const level = (levelSel?.value || covState.level || '').trim();
      if (level) params.append('level', level);
      params.append('city', region);

      const res = await fetch(`/api/coverage/districts?${params.toString()}`);
      let districts = await res.json().catch(() => []);

      if (districts && Array.isArray(districts.districts)) {
        districts = districts.districts;
      }
      if (!Array.isArray(districts)) districts = [];

      districtSel.innerHTML =
        '<option value="">êµ¬/êµ° ì„ íƒ</option>' +
        districts.map(d => {
          const name =
            typeof d === 'string'
              ? d
              : (d.district || d.name || d.district_name || '');
          return name ? `<option value="${name}">${name}</option>` : '';
        }).join('');
    } catch (e) {
      console.error('edit-district load error:', e);
      districtSel.innerHTML = '<option value="">êµ¬/êµ° ì„ íƒ</option>';
    }
  }


    function sortCoverageSummary(){
      const mode = covState.sort || 'pct-desc';
      covSummaryData.sort((a,b)=>{
        if (mode === 'pct-asc')   return a.pct - b.pct;
        if (mode === 'filled-desc') return b.filled - a.filled;
        if (mode === 'name') {
          // ì‹œ/ë„ ëª¨ë“œ = city ê¸°ì¤€, êµ¬/êµ° ëª¨ë“œ = district ê¸°ì¤€
          if (covState.view === 'district') {
            return (a.district || '').localeCompare(b.district || '', 'ko');
          }
          return (a.city || '').localeCompare(b.city || '', 'ko');
        }
        return b.pct - a.pct; // pct-desc
      });
    }

    async function refreshCoverageSummary(){
      const box = document.getElementById('cov-summary');
      if (!box) return;
      box.innerHTML = `<div class="cov-loading">ì§€ì—­ë³„ ì»¤ë²„ë¦¬ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>`;

      try {
        // êµ¬/êµ° ëª¨ë“œì¸ë° ì„ íƒëœ ì§€ì—­ì´ ì—†ìœ¼ë©´ ê°•ì œë¡œ ì‹œ/ë„ ëª¨ë“œë¡œ
        if (covState.view === 'district' && !covState.selectedCity) {
          covState.view = 'city';
        }

        if (covState.view === 'district') {
          // ===== êµ¬/êµ° ì¹´ë“œ ëª¨ë“œ =====
          const paramsForList = new URLSearchParams();
          if (covState.level) paramsForList.append('level', covState.level);
          paramsForList.append('city', covState.selectedCity);

          const resDist = await fetch(`/api/coverage/districts?${paramsForList.toString()}`);
          let districts = await resDist.json().catch(()=>[]);

          // ì„œë²„ê°€ { districts:[...] } í˜•íƒœë¡œ ì¤„ ìˆ˜ë„ ìˆì–´ì„œ ë³´ì •
          if (districts && Array.isArray(districts.districts)) {
            districts = districts.districts;
          }
          if (!Array.isArray(districts) || !districts.length) {
            covSummaryData = [];
            box.innerHTML = `<div class="cov-empty">${shortCityName(covState.selectedCity) || 'ì„ íƒí•œ ì§€ì—­'}ì˜ êµ¬/êµ° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
            return;
          }

          const statsPromises = districts.map(async d => {
            const name =
              typeof d === 'string'
                ? d
                : (d.district || d.name || d.district_name || '');

            const params = new URLSearchParams();
            if (covState.level)    params.append('level', covState.level);
            if (covState.year)     params.append('year',  covState.year);
            if (covState.grade)    params.append('grade', covState.grade);
            if (covState.semester) params.append('semester', covState.semester);
            if (covState.examType) params.append('exam_type', covState.examType);
            params.append('city', covState.selectedCity);
            if (name) params.append('district', name);

            const r = await fetch(`/api/coverage/stats?${params.toString()}`);
            if (!r.ok) {
              return {
                city: covState.selectedCity,
                district: name,
                total: 0,
                filled: 0,
                pct: 0
              };
            }
            const j = await r.json().catch(()=>({}));
            return {
              city: covState.selectedCity,
              district: name,
              total: Number(j.total)  || 0,
              filled: Number(j.filled) || 0,
              pct: Number(j.pct) || 0
            };
          });

          covSummaryData = await Promise.all(statsPromises);
        } else {
          // ===== ì‹œ/ë„ ì¹´ë“œ ëª¨ë“œ (ì›ë˜ ë¡œì§) =====
          const qLevel = encodeURIComponent(covState.level || '');
          const resCities = await fetch(`/api/coverage/cities?level=${qLevel}`);
          if (!resCities.ok) throw new Error('ì§€ì—­ ëª©ë¡ ì˜¤ë¥˜');
          const cities = await resCities.json().catch(()=>[]);
          if (!Array.isArray(cities) || !cities.length){
            covSummaryData = [];
            box.innerHTML = `<div class="cov-empty">í•™êµ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
            return;
          }

          const statsPromises = cities.map(async city => {
            const params = new URLSearchParams();
            if (covState.level)    params.append('level', covState.level);
            if (covState.year)     params.append('year',  covState.year);
            if (covState.grade)    params.append('grade', covState.grade);
            if (covState.semester) params.append('semester', covState.semester);   // '1' | '2'
            if (covState.examType) params.append('exam_type', covState.examType);  // 'mid' | 'final'
            params.append('city', city);

            const r = await fetch(`/api/coverage/stats?${params.toString()}`);
            if (!r.ok) return { city, total:0, filled:0, pct:0 };
            const j = await r.json().catch(()=>({}));
            return {
              city,
              total: Number(j.total)  || 0,
              filled: Number(j.filled) || 0,
              pct: Number(j.pct) || 0
            };
          });

          covSummaryData = await Promise.all(statsPromises);
        }

        sortCoverageSummary();
        renderCoverageCards();
      } catch(e) {
        console.error(e);
        box.innerHTML = `<div class="cov-error">ì»¤ë²„ë¦¬ì§€ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>`;
      }
    }

    function renderCoverageCards(){
      const box = document.getElementById('cov-summary');
      if (!box) return;

      if (!covSummaryData.length){
        box.innerHTML = `<div class="cov-empty">í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
        return;
      }

      const isDistrictView = (covState.view === 'district');
      const parts = [];

      // êµ¬/êµ° ëª¨ë“œì¼ ë•ŒëŠ” "ì „ì²´ ì§€ì—­ìœ¼ë¡œ" ëŒì•„ê°€ëŠ” ì¹´ë“œ í•˜ë‚˜ ì¶”ê°€
      if (isDistrictView) {
        parts.push(`
          <div class="cov-card" data-back="1">
            <div class="cov-card-top">
              <div class="cov-city">â† ${shortCityName(covState.selectedCity) || 'ì „ì²´ ì§€ì—­'}</div>
              <div class="cov-pct">ëª©ë¡</div>
            </div>
            <div class="cov-bar">
              <div class="cov-bar-inner" style="width:100%;"></div>
            </div>
            <div class="cov-count">ì§€ì—­ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</div>
          </div>
        `);
      }

      parts.push(
        covSummaryData.map(r=>{
          const pct = Math.max(0, Math.min(100, isFinite(r.pct) ? r.pct : 0));
          const filled = r.filled || 0;
          const total  = r.total  || 0;
          const isSelectedCity = (covState.selectedCity === r.city);

          // ì‹œ/ë„ ëª¨ë“œì—ì„œë§Œ ì„ íƒ ê°•ì¡°
          const selected = (!isDistrictView && isSelectedCity) ? 'cov-card-selected' : '';

          // ì¹´ë“œì— ì°í ì´ë¦„: ì‹œ/ë„ vs êµ¬/êµ°
          const label = isDistrictView
            ? (r.district || r.city || 'êµ¬/êµ° ë¯¸ì§€ì •')
            : (shortCityName(r.city) || 'ì§€ì—­ ë¯¸ì§€ì •');

          return `
            <div class="cov-card ${selected}"
                data-city="${r.city || ''}"
                data-district="${r.district || ''}">
              <div class="cov-card-top">
                <div class="cov-city">${label}</div>
                <div class="cov-pct">${pct}%</div>
              </div>
              <div class="cov-bar">
                <div class="cov-bar-inner" style="width:${pct}%;"></div>
              </div>
              <div class="cov-count">${filled} / ${total} ê°œ</div>
            </div>
          `;
        }).join('')
      );

      box.innerHTML = parts.join('');

      box.querySelectorAll('.cov-card').forEach(card=>{
        card.addEventListener('click', ()=>{
          const isBack   = card.getAttribute('data-back');
          const city     = card.getAttribute('data-city') || '';
          const district = card.getAttribute('data-district') || '';

          // â† ì „ì²´ ì§€ì—­ìœ¼ë¡œ ëŒì•„ê°€ê¸° ì¹´ë“œ
          if (isBack) {
            covState.view = 'city';
            covState.selectedCity = '';
            refreshCoverageSummary();

            // íŒŒì¼ ê²€ìƒ‰ í•„í„°ë„ ì´ˆê¸°í™”
            const regionSel   = document.getElementById('file-region');
            const districtSel = document.getElementById('file-district');
            if (regionSel) {
              regionSel.value = '';
              regionSel.dispatchEvent(new Event('change'));
            } else if (districtSel) {
              districtSel.value = '';
              districtSel.dispatchEvent(new Event('change'));
            }
            return;
          }

          // ì‹œ/ë„ ì¹´ë“œ í´ë¦­ â†’ í•´ë‹¹ ì§€ì—­ì˜ êµ¬/êµ° ì¹´ë“œë“¤ë¡œ ì „í™˜
          if (!isDistrictView) {
            if (!city) return;
            covState.selectedCity = city;
            covState.view = 'district';
            refreshCoverageSummary();

            // ì•„ë˜ íŒŒì¼ ê²€ìƒ‰ í•„í„°ì˜ "ì§€ì—­" selectë„ ë§ì¶°ì£¼ê¸°
            const regionSel = document.getElementById('file-region');
            if (regionSel) {
              regionSel.value = city;
              regionSel.dispatchEvent(new Event('change'));
            }
          } else {
            // êµ¬/êµ° ì¹´ë“œ í´ë¦­ â†’ íŒŒì¼ ê²€ìƒ‰ í•„í„°ì˜ êµ¬/êµ° ê°’ìœ¼ë¡œ ë°˜ì˜
            if (!district) return;
            const districtSel = document.getElementById('file-district');
            if (districtSel) {
              districtSel.value = district;
              districtSel.dispatchEvent(new Event('change'));
            }
          }
        });
      });
    }

    // ===== ì‚­ì œ / ìˆ˜ì • =====
    async function deleteFile(id, btn){
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      btn.disabled = true;
      try {
        const res = await fetch('/api/admin/files/' + id, {
          method: 'DELETE',
          credentials: 'include'
        });

        if (res.status === 401) {
          alert('ë¡œê·¸ì¸ í•„ìš”!');
          location.href = '/login.html';
          return;
        }

        let msg = '';
        const ct = res.headers.get('content-type') || '';

        if (res.ok) {
          if (ct.includes('application/json')) {
            const r = await res.json().catch(() => ({}));
            msg = r.message || r.msg || 'ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.';
          } else {
            msg = (await res.text().catch(() => '')) || 'ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.';
          }
          document.getElementById('msg').textContent = msg;
          await fetchFiles();
          applyFiltersAndRender();
        } else {
          const errText = ct.includes('application/json')
            ? (await res.json().catch(() => ({}))).message || (await res.text().catch(() => ''))
            : (await res.text().catch(() => ''));
          document.getElementById('msg').textContent = `ì‚­ì œ ì‹¤íŒ¨(${res.status}) ${errText || ''}`.trim();
        }
      } catch (e) {
        document.getElementById('msg').textContent = 'ì‚­ì œ ì˜¤ë¥˜: ' + (e?.message || '');
      } finally {
        btn.disabled = false;
      }
    }

    async function editFile(id){
      editTargetId = id;
      const row    = fileListOrigin.find(r=>r.id === id);
      const form   = document.getElementById('edit-form');
      if (!row || !form) return;

      // ê¸°ë³¸ ê°’ ì„¸íŒ…
      form.level.value  = row.level  || '';
      form.school.value = row.school || '';
      form.title.value  = row.title  || '';

      // ğŸ”¹ í•™ë…„: DBì— ìˆ«ì/1í•™ë…„/ì¤‘1/ê³ 1 ë“± ì–´ë–»ê²Œ ë“¤ì–´ìˆì–´ë„
      //    ë“œë¡­ë‹¤ìš´(ì¤‘1~ê³ 3)ì— ë§ì¶°ì„œ ìë™ ì„ íƒë˜ê²Œ ë³€í™˜
      (function applyGrade(){
        const levelVal = row.level || form.level.value || '';   // ì¤‘ë“± / ê³ ë“±
        const rawGrade = (row.grade || '').toString().trim();   // DBì—ì„œ ì˜¨ ê°’

        // ì´ë¯¸ 'ì¤‘1','ì¤‘2','ê³ 3' í˜•ì‹ì´ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        if (['ì¤‘1','ì¤‘2','ì¤‘3','ê³ 1','ê³ 2','ê³ 3'].includes(rawGrade)) {
          form.grade.value = rawGrade;
          return;
        }

        // '1', '2', '3' ë˜ëŠ” '1í•™ë…„', '2í•™ë…„', '3í•™ë…„' ê°™ì€ í˜•ì‹ ì²˜ë¦¬
        let num = '';
        if (/^[1-3]$/.test(rawGrade)) {
          num = rawGrade;
        } else {
          const m = rawGrade.match(/([1-3])\s*í•™ë…„?/);
          if (m) num = m[1];
        }

        if (!num) {
          // ë§¤ì¹­ ì•ˆ ë˜ë©´ ê·¸ëƒ¥ ë¹„ì›Œë‘ê¸°
          form.grade.value = '';
          return;
        }

        // ê´€ì— ë”°ë¼ ì¤‘/ê³  ë¶™ì´ê¸°
        const prefix = (levelVal === 'ì¤‘ë“±') ? 'ì¤‘' : 'ê³ ';
        form.grade.value = `${prefix}${num}`;
      })();

      // ì—°ë„ëŠ” ì„ íƒê°’ (2024 / 2025)
      if (form.year) {
        form.year.value = row.year ? String(row.year) : '';
      }

      // í•™ê¸°/êµ¬ë¶„ ë¶„ë¦¬
      let semVal  = '';
      let examVal = '';

      // ìƒˆ êµ¬ì¡°(semester='1í•™ê¸°', exam_type='ì¤‘ê°„') ìš°ì„ 
      if (row.semester && (row.semester === '1í•™ê¸°' || row.semester === '2í•™ê¸°')) {
        semVal = row.semester;
      }
      if (row.exam_type && (row.exam_type === 'ì¤‘ê°„' || row.exam_type === 'ê¸°ë§')) {
        examVal = row.exam_type;
      }

      // í˜¹ì‹œ ì˜ˆì „ì²˜ëŸ¼ '1í•™ê¸°ì¤‘ê°„' ê°™ì´ í•©ì³ì ¸ ìˆìœ¼ë©´ ë¶„í•´
      if (!semVal && row.semester) {
        const s = String(row.semester);
        if (s.includes('1í•™ê¸°')) semVal = '1í•™ê¸°';
        else if (s.includes('2í•™ê¸°')) semVal = '2í•™ê¸°';

        if (s.includes('ì¤‘ê°„')) examVal = 'ì¤‘ê°„';
        else if (s.includes('ê¸°ë§')) examVal = 'ê¸°ë§';
      }

      if (form.semester)  form.semester.value  = semVal || '';
      if (form.exam_type) form.exam_type.value = examVal || '';

      // ê´€/ì§€ì—­/êµ¬êµ°ì€ ì»¤ë²„ë¦¬ì§€ì—ì„œ ë°›ì•„ì™€ì„œ ì„¸íŒ…
      await loadEditRegions();

      if (form.region && row.region) {
        form.region.value = row.region;
      }
      await loadEditDistricts(row.region || '');

      if (form.district && row.district) {
        form.district.value = row.district;
      }

      // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
      if (form.files) form.files.value = '';

      // ëª¨ë‹¬ í‘œì‹œ
      document.getElementById('edit-bg').style.display = 'flex';
    }

    function closeEdit(){
      document.getElementById('edit-bg').style.display='none';
      document.getElementById('edit-form').reset();
    }

    document.getElementById('edit-form').onsubmit = async function(e){
      e.preventDefault();
      const btn = document.getElementById('edit-save-btn');
      btn.disabled = true;

      try {
        const fd  = new FormData(e.target);
        const res = await fetch('/api/admin/files/' + editTargetId, {
          method: 'PUT',
          body: fd,
          credentials: 'include'
        });

        let msg = '';
        const ct = res.headers.get('content-type') || '';

        if (ct.includes('application/json')) {
          const r = await res.json().catch(() => ({}));
          msg = r.message || r.msg || (res.ok ? 'ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ì €ì¥ ì‹¤íŒ¨');
        } else {
          msg = (await res.text().catch(() => '')) || (res.ok ? 'ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ì €ì¥ ì‹¤íŒ¨');
        }

        document.getElementById('msg').textContent = msg;
      } catch (err) {
        document.getElementById('msg').textContent = 'ì €ì¥ ì˜¤ë¥˜: ' + (err?.message || '');
      } finally {
        btn.disabled = false;
        closeEdit();
        await fetchFiles();
        applyFiltersAndRender();
      }
    };
    
    // ë©”ëª¨ë¥¼ /api/my/memos/:fileId ì—ì„œ ë³„ë„ë¡œ ë¶ˆëŸ¬ì˜¤ë„ë¡ ë³€ê²½
    async function selectFileDetail(id){
      const row = fileListOrigin.find(r => r.id === id);
      if (!row) return;

      const emptyEl = document.getElementById('file-detail-empty');
      const bodyEl  = document.getElementById('file-detail-body');
      if (emptyEl) emptyEl.style.display = 'none';
      if (bodyEl)  bodyEl.style.display  = 'block';

      // ìƒë‹¨ í° ì•„ì´ì½˜ + ì•„ë˜ ì‘ì€ ì•„ì´ì½˜ ë‘˜ ë‹¤ ë³€ê²½
      const iconMain  = document.getElementById('detail-file-icon-main');
      const iconSmall = document.getElementById('detail-file-icon-small');

      let src = 'image_download/pdf_download.png';
      let alt = 'íŒŒì¼ ì•„ì´ì½˜';

      if (row.files && row.files.pdf) {
        src = 'image_download/pdf_download.png';
        alt = 'PDF íŒŒì¼';
      } else if (row.files && row.files.hwp) {
        src = 'image_download/hwp_download.png';
        alt = 'HWP íŒŒì¼';
      }

      if (iconMain)  { iconMain.src  = src; iconMain.alt  = alt; }
      if (iconSmall) { iconSmall.src = src; iconSmall.alt = alt; }

      // ğŸ”½ íŒŒì¼ëª… ì•„ë˜ PDF/HWP ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ë§í¬ & í‘œì‹œ ì œì–´
      const pdfBtn = document.getElementById('detail-download-pdf');
      const hwpBtn = document.getElementById('detail-download-hwp');

      if (pdfBtn) {
        if (row.files && row.files.pdf) {
          pdfBtn.href = `/api/download/${row.id}?type=pdf`;
          pdfBtn.style.display = 'inline-flex';
        } else {
          pdfBtn.style.display = 'none';
        }
      }

      if (hwpBtn) {
        if (row.files && row.files.hwp) {
          hwpBtn.href = `/api/download/${row.id}?type=hwp`;
          hwpBtn.style.display = 'inline-flex';
        } else {
          hwpBtn.style.display = 'none';
        }
      }

      // ìƒë‹¨ íŒŒì¼ëª… (ì œëª© ê¸°ì¤€)
      const nameEl = document.getElementById('detail-file-name');
      if (nameEl) {
        nameEl.textContent = row.title || '(ì œëª© ì—†ìŒ)';
      }

      // ì•„ë˜ ì •ë³´ë“¤
      const schoolEl = document.getElementById('detail-school');
      if (schoolEl) {
        const schoolText = [row.region, row.district, row.school]
          .filter(Boolean)
          .join(' ');
        schoolEl.textContent = schoolText || '-';
      }

      const metaEl = document.getElementById('detail-meta-year');
      if (metaEl) {
        // ì—°ë„ / í•™ë…„ / í•™ê¸° / êµ¬ë¶„ â†’ 2024ë…„ 2í•™ë…„ 1í•™ê¸° ê¸°ë§
        const yearText  = row.year     ? `${row.year}ë…„` : '';
        const gradeText = row.grade    ? `${row.grade}í•™ë…„` : '';

        let semesterText = '';
        if (row.semester) {
          const semNum = String(row.semester).replace(/í•™ê¸°/g, '');
          semesterText = `${semNum}í•™ê¸°`;
        }

        const examText = row.exam_type || '';

        const parts = [yearText, gradeText, semesterText, examText]
          .filter(Boolean);

        metaEl.textContent = parts.length ? parts.join(' ') : '-';
      }

      const subjEl  = document.getElementById('detail-subject');
      if (subjEl)   subjEl.textContent  = row.subject || '-';

      // PDF ì—…ë¡œë“œì¼
      const pdfDateEl = document.getElementById('detail-pdf-date');
      if (pdfDateEl) {
        pdfDateEl.textContent = row.pdf_uploaded_at || '-';
      }

      // HWP ì—…ë¡œë“œì¼
      const hwpDateEl = document.getElementById('detail-hwp-date');
      if (hwpDateEl) {
        hwpDateEl.textContent = row.hwp_uploaded_at || '-';
      }

      // âœ… ë©”ëª¨ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ (APIì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ê¸°)
      const memoListEl = document.getElementById('detail-memo-list');
      if (!memoListEl) return;

      // ë¨¼ì € "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘" í‘œì‹œ
      memoListEl.innerHTML = '<p class="memo-empty">ë©”ëª¨ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';

      let memos = [];
      try {
        const res = await fetch(`/api/my/memos/${encodeURIComponent(id)}`, {
          credentials: 'include'
        });

        if (res.ok) {
          const data = await res.json().catch(() => null);

          if (Array.isArray(data)) {
            memos = data;
          } else if (data && Array.isArray(data.memos)) {
            memos = data.memos;
          } else if (data && (data.memo || data.content)) {
            memos = [data];
          }
        } else if (res.status === 401) {
          memoListEl.innerHTML =
            '<p class="memo-empty">ë¡œê·¸ì¸ í›„ ë©”ëª¨ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>';
          return;
        } else {
          memoListEl.innerHTML =
            '<p class="memo-empty">ë©”ëª¨ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>';
          return;
        }
      } catch (e) {
        console.error('memo load error', e);
        memoListEl.innerHTML =
          '<p class="memo-empty">ë©”ëª¨ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>';
        return;
      }

      memoListEl.innerHTML = '';

      // ì•„ë¬´ ë©”ëª¨ë„ ì—†ìœ¼ë©´, ê¸°ì¡´ row.memo ì‚¬ìš© or ê¸°ë³¸ ë¬¸êµ¬
      if (!memos.length) {
        const empty = document.createElement('p');
        empty.className = 'memo-empty';
        const memoText = (row.memo && String(row.memo).trim()) || '';
        empty.textContent = memoText || 'ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.';
        memoListEl.appendChild(empty);
        return;
      }

      // ìµœì‹ ìˆœ ì •ë ¬
      memos.sort((a, b) => {
        const da = new Date(a.updated_at || a.created_at || a.createdAt || 0);
        const db = new Date(b.updated_at || b.created_at || b.createdAt || 0);
        return db - da;
      });

      memos.forEach(m => {
        const item = document.createElement('div');
        item.className = 'memo-item';

        // ìƒë‹¨ ì‘ì„±ì / ì´ë©”ì¼ / ë‚ ì§œ
        const meta = document.createElement('div');
        meta.className = 'memo-meta';

        const authorWrap = document.createElement('div');
        authorWrap.className = 'memo-author-wrap';

        const authorLine = document.createElement('div');
        authorLine.className = 'memo-author';

        // ğŸ”¹ ë°±ì—”ë“œê°€ ì–´ë–¤ êµ¬ì¡°ë¡œ ë³´ë‚´ë„ ì›¬ë§Œí•˜ë©´ ë‹¤ ì¡ë„ë¡ í‚¤ë¥¼ ë„“ê²Œ ì²˜ë¦¬
        const userObj = m.user || m.owner || m.author || {};

        const userId =
          m.user_id ||
          m.userId ||
          m.writer_id ||
          m.writerId ||
          userObj.user_id ||
          userObj.userId ||
          userObj.id ||
          '';

        const userName =
          m.name ||
          m.user_name ||
          m.username ||
          m.writer_name ||
          m.writerName ||
          userObj.name ||
          userObj.username ||
          userObj.display_name ||
          '';

        const userEmail =
          m.email ||
          m.user_email ||
          m.writer_email ||
          userObj.email ||
          userObj.user_email ||
          '';

        if (userId && userName) {
          authorLine.textContent = `${userId} (${userName})`;
        } else if (userId) {
          authorLine.textContent = userId;
        } else if (userName) {
          authorLine.textContent = userName;
        } else {
          authorLine.textContent = 'ì•Œ ìˆ˜ ì—†ëŠ” ì‚¬ìš©ì';
        }

        const emailLine = document.createElement('div');
        emailLine.className = 'memo-email';
        emailLine.textContent = userEmail || '';

        authorWrap.appendChild(authorLine);
        authorWrap.appendChild(emailLine);

        const dateLine = document.createElement('div');
        dateLine.className = 'memo-date';
        const rawDate =
          m.updated_at || m.created_at || m.createdAt || '';
        if (rawDate) {
          dateLine.textContent = String(rawDate).replace('T', ' ').slice(0, 16);
        } else {
          dateLine.textContent = '';
        }

        meta.appendChild(authorWrap);
        meta.appendChild(dateLine);

        const content = document.createElement('div');
        content.className = 'memo-content';
        content.textContent = m.memo || m.content || '';

        item.appendChild(meta);
        item.appendChild(content);

        memoListEl.appendChild(item);
      });
    }

    // íŒŒì¼ ë“œë˜ê·¸ì•¤ë“œë¡­ + ì»¤ìŠ¤í…€ ì—…ë¡œë“œ ë²„íŠ¼ (ê¸°ì¡´ ê·¸ëŒ€ë¡œ)
    const dropArea   = document.getElementById('fileDropArea');
    const fileInput  = document.getElementById('fileInput');
    const fileBtn    = document.getElementById('fileSelectBtn');
    const fileListEl = document.getElementById('fileList');
    const fileTextEl = document.getElementById('fileUploadText');

    fileBtn.onclick = () => fileInput.click();

    dropArea.addEventListener('dragover', e => {
      e.preventDefault(); dropArea.classList.add('dragover');
    });
    dropArea.addEventListener('dragleave', e => {
      e.preventDefault(); dropArea.classList.remove('dragover');
    });
    dropArea.addEventListener('drop', e => {
      e.preventDefault(); dropArea.classList.remove('dragover');
      if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
        fileInput.files = e.dataTransfer.files;
        updateFileList();
      }
    });
    fileInput.addEventListener('change', updateFileList);

    function updateFileList() {
      fileListEl.innerHTML = '';
      if (!fileInput.files.length) {
        fileTextEl.innerHTML = 'ì—¬ê¸°ë¡œ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ <b>íŒŒì¼ ì¶”ê°€</b> ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”';
        return;
      }

      const firstFile = fileInput.files[0];
      const filename = firstFile.name.replace(/\.[^/.]+$/, "");
      const parts = filename.split(' ');

      // ì˜ˆ: "2025 ê²€ë‹¨ê³  2í•™ë…„ 1í•™ê¸° ê¸°ë§ ìˆ˜í•™1"
      if (parts.length >= 6) {
        const [year, school, grade, semester, exam, ...rest] = parts;
        const form = document.getElementById('edit-form');

        if (form) {
          // ì—°ë„
          if (form.year) {
            form.year.value = parseInt(year, 10) ? String(parseInt(year, 10)) : '';
          }

          // í•™êµëª… / ì œëª©
          form.school.value = school || '';
          form.title.value  = filename;

          // í•™ë…„: íŒŒì¼ëª…ì—ì„œ "1í•™ë…„" / "2í•™ë…„" / "3í•™ë…„" ì´ë¼ê³  ë“¤ì–´ì™”ì„ ë•Œ
          const level = form.level.value;
          if (grade === '1í•™ë…„') {
            form.grade.value = (level === 'ê³ ë“±') ? 'ê³ 1' : 'ì¤‘1';
          } else if (grade === '2í•™ë…„') {
            form.grade.value = (level === 'ê³ ë“±') ? 'ê³ 2' : 'ì¤‘2';
          } else if (grade === '3í•™ë…„') {
            form.grade.value = (level === 'ê³ ë“±') ? 'ê³ 3' : 'ì¤‘3';
          }

          // í•™ê¸° / êµ¬ë¶„ ë¶„ë¦¬
          if (form.semester && (semester === '1í•™ê¸°' || semester === '2í•™ê¸°')) {
            form.semester.value = semester;
          }
          if (form.exam_type && (exam === 'ì¤‘ê°„' || exam === 'ê¸°ë§')) {
            form.exam_type.value = exam;
          }
        }
      }

      Array.from(fileInput.files).forEach(f => {
        const span = document.createElement('span');
        span.className = 'file-item';
        span.textContent = f.name;
        fileListEl.appendChild(span);
      });
      fileTextEl.textContent = 'ì„ íƒëœ íŒŒì¼:';
    }


    function previewFile(filename){
      // ì´ í•¨ìˆ˜ëŠ” ë” ì´ìƒ í˜¸ì¶œë˜ì§€ ì•Šìœ¼ë‚˜ ê¸°ì¡´ êµ¬ì¡° ìœ ì§€
    }
    function closePreview(){
      document.getElementById('preview-bg').style.display='none';
      document.getElementById('preview-body').innerHTML='';
    }

    // íŒŒì¼ ë¦¬ìŠ¤íŠ¸ ì „ìš© í•„í„°ëŠ” ì…€ë ‰íŠ¸ ë³€ê²½ ì‹œ ë°”ë¡œ ë°˜ì˜
    const levelFilter = document.getElementById('file-level');
    if (levelFilter) {
      levelFilter.addEventListener('change', () => {
        updateSubjectOptions();       // ê´€ ë°”ë€Œë©´ ê³¼ëª© ëª©ë¡ë„ ë³€ê²½
        applyFiltersAndRender();
      });
    }
    document.getElementById('file-semester')?.addEventListener('change', applyFiltersAndRender);
    document.getElementById('file-exam')?.addEventListener('change', applyFiltersAndRender);
    document.getElementById('file-subject')?.addEventListener('change', applyFiltersAndRender);


    // ì´ˆê¸° ì‹¤í–‰
    (async function init(){
      await fetchFiles();
      await initCoverageFilters();
      await refreshCoverageSummary();

      // íŒŒì¼ ë¦¬ìŠ¤íŠ¸ìš© ì§€ì—­/êµ¬êµ° í•„í„° ì´ˆê¸°í™”
      await loadFileFilterRegions();   // ì§€ì—­ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°

      const regionSel   = document.getElementById('file-region');
      const districtSel = document.getElementById('file-district');

      if (regionSel) {
        regionSel.addEventListener('change', (e) => {
          loadFileFilterDistricts(e.target.value);
          applyFiltersAndRender();
        });
      }
      if (districtSel) {
        districtSel.addEventListener('change', applyFiltersAndRender);
      }

            // ìˆ˜ì • ëª¨ë‹¬ ê´€/ì§€ì—­ ë³€ê²½ ì‹œ ì»¤ë²„ë¦¬ì§€ ê¸°ë°˜ ë“œë¡­ë‹¤ìš´ ì—°ë™
      const editForm = document.getElementById('edit-form');
      if (editForm) {
        const editLevelSel  = editForm.querySelector('select[name="level"]');
        const editRegionSel = editForm.querySelector('select[name="region"]');

        if (editLevelSel) {
          editLevelSel.addEventListener('change', async () => {
            await loadEditRegions();
            const regionVal =
              editForm.querySelector('select[name="region"]')?.value || '';
            await loadEditDistricts(regionVal);
          });
        }

        if (editRegionSel) {
          editRegionSel.addEventListener('change', (e) => {
            loadEditDistricts(e.target.value);
          });
        }
      }

      // í˜ì´ì§€ ì§„ì… ì‹œ ê´€ ì„¤ì •ì— ë§ê²Œ ê³¼ëª© ì˜µì…˜ ë¨¼ì € ì±„ì›€
      updateSubjectOptions();
      applyFiltersAndRender();
    })();
  </script>
</body>
</html>
