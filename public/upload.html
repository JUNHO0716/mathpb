<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì‹œí—˜ì§€ ì—…ë¡œë“œ</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/common.css">
<style>
body {
  font-family: 'Noto Sans KR', sans-serif;
  margin: 0;
  background: #fff;
}
.page-banner {
  background: #ffffff;
  border-bottom: 1px solid #000;
  padding: 70px 0;
  text-align: center;
}
.page-banner h2 {
  font-size: 2.4rem;
  font-weight: 900;
  margin-bottom: 14px;
}
.page-banner p {
  font-size: 1rem;
  opacity: .85;
  margin: 0;
}
.main-wrapper {
  display: flex;
  width: 100%;
  /* ì•„ë˜ë¡œ ì¶©ë¶„íˆ ê¸¸ì–´ì§€ë„ë¡, ë·°í¬íŠ¸ ë†’ì´ ìµœì†Œ ë³´ì¥ */
  min-height: 100vh;
}
.left-panel {
  width: 20%;
  background: #f9f9f9;
  border-right: 1px solid #ddd;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  padding: 24px;
  /* í™”ë©´ ìƒë‹¨ë¶€í„° ì•„ë˜ë¡œ ì­‰ 100% ë·°í¬íŠ¸ ë†’ì´ */
  position: sticky;
  top: 0;
  align-self: flex-start;
  height: 100vh;
}
.left-panel h3 {
  font-size: 1.2rem;
  margin-bottom: 16px;
}
.upload-box {
  border: 2px dashed #bcbcbc;
  padding: 40px 20px;
  width: 100%;
  background-color: #ffffff;
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.3s;
}
.upload-box:hover {
  background: #f0f0f0;
}
.upload-box input[type="file"] {
  display: none;
}
.upload-box label {
  display: block;
  cursor: pointer;
}
.right-panel {
  width: 80%;
  display: flex;
  flex-direction: column;
  padding: 24px;
  gap: 20px;
  box-sizing: border-box;
}
.status-section, .completed-section, .rejected-section {
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 20px;
}
.section-title {
  font-size: 1.2rem;
  font-weight: bold;
  margin-bottom: 16px;
}
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.95rem;
}
th, td {
  border: 1px solid #ddd;
  padding: 10px;
  text-align: center;
}
th {
  background: #f0f0f0;
}
.status-working {
  color: orange;
}
.status-completed {
  color: green;
  font-weight: bold;
}
.status-rejected {
  color: red;
}

.card-status,
.status-working,
.status-completed,
.status-rejected {
  color: #000 !important;
}

.card-container {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
}

.card {
  display: flex;               /* ì´ ì¤„ ì¶”ê°€ */
  flex-direction: column;      /* ì´ ì¤„ë„ ì¶”ê°€í•´ì•¼ ìœ„/ì•„ë˜ë¡œ ë¶„ë¦¬ë©ë‹ˆë‹¤ */
  width: 160px;
  border: none; 
  justify-content: space-between; /* ìœ„ì™€ ì•„ë˜ë¡œ ìš”ì†Œë¥¼ ë¶„ë¦¬ */
  border-radius: 12px;
  padding: 12px;
  text-align: center;
  font-size: 0.9rem;
  background-color: #f7f7f7;
  box-shadow:
    0 6px 12px rgba(243, 194, 75, 0.35),
    0 0 8px rgba(243, 194, 75, 0.2);
}
.card img {
  width: 50px;
  margin: 10px 0;
}

.card-label {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  position: relative;      /* ::after íˆ´íŒìš© */
}

/* íˆ´íŒìš© ::after */
.card-label::after {
  content: attr(data-fullname);
  position: absolute;
  left: 0; bottom: calc(100% + 6px);
  background: rgba(0,0,0,0.85);
  color: #fff;
  padding: 4px 8px;
  border-radius: 4px;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity .2s ease-in .8s;   /* 0.8ì´ˆ ë”œë ˆì´ í›„ fade-in */
  z-index: 10;
}

.card img {
  display: block;
  margin: 12px auto;     /* ìœ„ì•„ë˜ 12px, ì¢Œìš° ìë™ */
  width: 80px;           /* ì›í•˜ëŠ” í¬ê¸°ë¡œ ì¡°ì ˆ */
}


.card-label:hover::after {
  opacity: 1;
}

.card-status {
  margin-top: 8px; /* ìœ„ í…ìŠ¤íŠ¸ì™€ ê°„ê²© */
  text-align: left;
}

.dots {
  display: inline-block;
}

.dots span {
  animation: wave 1.2s infinite;
  display: inline-block;
  font-weight: bold;
  font-size: 1rem;
}

.dots span:nth-child(1) {
  animation-delay: 0s;
}
.dots span:nth-child(2) {
  animation-delay: 0.2s;
}
.dots span:nth-child(3) {
  animation-delay: 0.4s;
}
.dots span:nth-child(4) { animation-delay: 0.6s; }
.dots span:nth-child(5) { animation-delay: 0.8s; }
.dots span:nth-child(6) { animation-delay: 1s; }

/* HEAD style ì•ˆì— ì¶”ê°€! */
.preview-item {
  width: 100%;
  min-height: 40px;         /* ë†’ì´ ë” ë‚®ê²Œ */
  border: 1.5px solid #eee;
  border-radius: 8px;       /* ë” ì‘ì€ radius */
  display: flex;
  align-items: center;
  margin-bottom: 5px;
  background: #fff;
  box-shadow: 0.5px 0.5px 3px rgba(0,0,0,0.04);
  padding: 5px 10px 5px 8px;   /* ì—¬ë°±ë„ ì¤„ì„ */
}
.preview-item img {
  width: 22px;              /* ì•„ì´ì½˜ ë” ì‘ê²Œ */
  margin-right: 10px;
}
.preview-item .filename {
  flex: 1;
  text-align: left;
  font-size: 0.8em;         /* ê¸€ì”¨ë„ ì•½ê°„ ì‘ê²Œ */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 140px;
}
.preview-item .remove-btn {
  cursor: pointer;
  color: #111;
  font-size: 1.05em;
  margin-left: 12px;
}

.preview-bottom-btns {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 7px;
  margin-top: 12px;
  position: absolute;     /* ì™¼ìª½ íŒ¨ë„ í•˜ë‹¨ì— ê³ ì • */
  left: 0;
  bottom: 30px;
  padding: 0 24px;
  box-sizing: border-box;
}

#upload-btn,
#add-file-btn {
  width: 100%;
  padding: 8px 0;
  font-size: 1.04rem;
  border-radius: 7px;
  border: none;
  font-weight: 700;
  cursor: pointer;
}

#upload-btn { background: #ffcb2c; color: #222; }
#add-file-btn { background: #e0e7ef; color: #333; }

#preview-card-container {
  margin: 0;
  padding: 0;
}

#upload-head-area {
  margin-top: 130px;  /* ì›í•˜ëŠ” ë§Œí¼ ì¡°ì • (ì˜ˆ: 120px) */
}

/* ì„ íƒëœ ì¹´ë“œ ê°•ì¡° */
.card.selected {
  border-color: #f44 !important;
  box-shadow: 0 0 8px rgba(244,0,0,0.4);
}
/* ì œì‘ì¤‘ ì¹´ë“œ ë¹„í™œì„±í™” */
.card.disabled {
  opacity: 0.5;
  cursor: not-allowed;
  pointer-events: none;
}
@keyframes wave {
  0% { transform: translateY(0); }
  30% { transform: translateY(-4px); }
  60% { transform: translateY(0); }
  100% { transform: translateY(0); }
}

/* ì‚­ì œí•˜ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
#delete-btn {
  background-color: #000;
  color: #fff;
  border: none;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
}

/* ëª¨ë‹¬ ì•ˆì˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
#confirm-delete, #cancel-delete {
  padding: 6px 12px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  margin: 0 6px;
}
#confirm-delete {
  background-color: #000;
  color: #fff;
}
#cancel-delete {
  background-color: #e0e0e0;
  color: #000;
}

/* 1) í—¤ë” ì•ˆì—ì„œ ì œëª©ê³¼ ë²„íŠ¼ì„ ì¢Œìš°ë¡œ ì •ë ¬ */
.status-section .section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* 2) ì‚­ì œ ë²„íŠ¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼ (ê²€ì • ë°”íƒ• + í° ê¸€ì”¨) */
#delete-btn {
  background-color: #000;
  color: #fff;
  border: none;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
  /* float ì œê±°í•˜ê³  ë§ˆì§„ ì´ˆê¸°í™” */
  float: none;
  margin: 0;
}

/* ì‚­ì œí•˜ê¸° & ìš”ì²­ í™•ì¸ ê³µí†µ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.btn-delete {
  background-color: #000;
  color: #fff;
  border: none;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.95rem;
  margin-left: 6px;            /* ì• ë²„íŠ¼ê³¼ì˜ ê°„ê²© */
}

.btn-delete:disabled {
  opacity: 0.6;                /* ë¹„í™œì„±í™” ì‹œ ì‚´ì§ íˆ¬ëª… */
  cursor: not-allowed;
}

/* í•„ìš”ì‹œ hover íš¨ê³¼ë„ ë™ì¼í•˜ê²Œ */
.btn-delete:hover:enabled {
  background-color: #222;
}

.status-section .section-header {
  display: flex;
  align-items: center;
  gap: 6px;       /* ë²„íŠ¼ë“¤ ì‚¬ì´ ê°„ê²© */
}

/* ì‚­ì œí•˜ê¸° & ìš”ì²­ í™•ì¸ ê³µí†µ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.btn-delete {
  background-color: #000;
  color: #fff;
  border: none;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.95rem;
  /* margin-left ì œê±° */
}

.btn-delete:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.btn-delete:hover:enabled {
  background-color: #222;
}

.card.status-completed {
  /* ê¸°ì¡´ ë…¸ë€ë¹› ê·¸ë¦¼ì ëŒ€ì‹ , ë˜ëŠ” ì¶”ê°€ë¡œ */
  box-shadow:
    /* ê¸°ì¡´ ë…¸ë€ë¹›ì„ ì‚­ì œí•˜ê³  ì‹¶ìœ¼ë©´ ì´ ì¤„ë§Œ ë‚¨ê¸°ì„¸ìš” */
    0 6px 12px rgba(75, 192, 192, 0.2),
    0 0 8px rgba(75, 192, 192, 0.1);
}


</style>
</head>
<body>
<section class="page-banner">
  <div class="inner">
    <h2>ì‹œí—˜ì§€ ì—…ë¡œë“œ</h2>
    <p>ì‹œí—˜ì§€ PDF íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´, ìˆœì„œëŒ€ë¡œ ì‘ì—…ë©ë‹ˆë‹¤.</p>
  </div>
</section>
<div class="main-wrapper">
<div class="left-panel">
  <div id="upload-head-area">
    <h3>Upload Files</h3>
    <form class="upload-box" id="uploadForm" enctype="multipart/form-data" onsubmit="return false;">
      <div id="drag-area">
        <label for="fileInput">
          <i class="fas fa-cloud-upload-alt fa-2x" style="margin-bottom:10px;"></i><br>
          Drag and drop files<br>
          <span style="font-size:0.85rem;color:#777;">or click to choose files (PDF, Max: 1GB, ìµœëŒ€ 10ê°œ)</span>
        </label>
        <input type="file" id="fileInput" name="fileInput" multiple accept="application/pdf" style="display:none;"/>
      </div>
    </form>
  </div>
  <div id="preview-card-container"></div>
  <!-- ë²„íŠ¼ì„ ì—¬ê¸°ë¡œ ì´ë™! -->
  <div class="preview-bottom-btns">
    <button id="upload-btn" type="button">íŒŒì¼ ì—…ë¡œë“œ</button>
    <button id="add-file-btn" type="button" style="display:none;">íŒŒì¼ ì¶”ê°€</button>
  </div>
</div>
  <div class="right-panel">
  <div class="status-section">
    <div class="section-header">
      <h3 class="section-title">ì—…ë¡œë“œ íŒŒì¼</h3>
      <!-- ê´€ë¦¬ì ì „ìš© ìš”ì²­ í™•ì¸ ë²„íŠ¼ -->
      <button id="admin-move-btn" class="btn-delete" style="display:none;">
        ìš”ì²­ í™•ì¸
      </button>
      <!-- ì‚­ì œí•˜ê¸° ë²„íŠ¼ -->
      <button id="delete-btn" class="btn-delete" disabled>
        ì‚­ì œí•˜ê¸°
      </button>
    </div>

    <div class="card-container" id="upload-card-container"></div>
  </div>
    <div class="completed-section">
      <h3 class="section-title">ì™„ë£Œ íŒŒì¼</h3>
      <div class="card-container" id="completed-card-container"></div>
    </div>
    <div class="rejected-section">
      <h3 class="section-title">ë°˜ë ¤ íŒŒì¼</h3>
      <table>
        <thead>
          <tr>
            <th>íŒŒì¼ëª…</th>
            <th>ë°˜ë ¤ ì‚¬ìœ </th>
          </tr>
        </thead>
        <tbody id="rejected-body">
        </tbody>
      </table>
    </div>
  </div>
</div>
<!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ (body ë ë°”ë¡œ ìœ„) -->
<div id="delete-modal" style="
     display:none; position:fixed; top:0; left:0;
     width:100%; height:100%; background:rgba(0,0,0,0.4);
     align-items:center; justify-content:center;
">
  <div style="
       background:#fff; padding:20px; border-radius:8px;
       text-align:center; min-width:240px;
  ">
    <p>ì •ë§ ì„ íƒí•œ íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
    <button id="confirm-delete">ì‚­ì œ</button>
    <button id="cancel-delete">ì·¨ì†Œ</button>
  </div>
</div>
</body>
<script>
let selectedFiles = [];

const deleteBtn     = document.getElementById('delete-btn');
const deleteModal   = document.getElementById('delete-modal');
const confirmDelete = document.getElementById('confirm-delete');
const cancelDelete  = document.getElementById('cancel-delete');
let selectedIds = [];
const fileInput = document.getElementById('fileInput');
const previewCardContainer = document.getElementById('preview-card-container');
const uploadBtn = document.getElementById('upload-btn');
const addFileBtn = document.getElementById('add-file-btn');
const dragArea = document.getElementById('drag-area');
const uploadHeadArea = document.getElementById('upload-head-area');
const leftPanel = document.querySelector('.left-panel');
const uploadCardContainer = document.getElementById('upload-card-container');
const rejectedBody       = document.getElementById('rejected-body');
const completedCardContainer = document.getElementById('completed-card-container');

// 1) íŒŒì¼ ì²˜ë¦¬ ë¡œì§ì„ ë¶„ë¦¬
function handleFileSelection(files) {
  // PDFë§Œ, ìµœëŒ€ 10ê°œ
  const pdfs = files.filter(f => f.type === 'application/pdf');
  if (selectedFiles.length + pdfs.length > 10) {
    alert('ìµœëŒ€ 10ê°œê¹Œì§€ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
    return;
  }
  pdfs.forEach(file => {
    if (!selectedFiles.some(f => f.name === file.name && f.size === file.size)) {
      selectedFiles.push(file);
    }
  });

  // ì—…ë¡œë“œ í—¤ë” ìˆ¨ê¹€/ì¶”ê°€ ë²„íŠ¼ ë…¸ì¶œ
  if (selectedFiles.length > 0) {
    uploadHeadArea.style.display = 'none';
    addFileBtn.style.display     = 'block';
  } else {
    uploadHeadArea.style.display = '';
    addFileBtn.style.display = 'none';
  }

  renderPreviewCards();
}

// 2) file input change ì‹œì—ë„ ê°™ì€ í•¨ìˆ˜ í˜¸ì¶œ
fileInput.addEventListener('change', function (e) {
  handleFileSelection(Array.from(e.target.files));
  fileInput.value = '';
});

// íŒŒì¼ ì¶”ê°€ ë²„íŠ¼
addFileBtn.addEventListener('click', () => fileInput.click());

// 3) ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸ë¥¼ left-panel ì „ì²´ì— ë°”ì¸ë”©
['dragenter', 'dragover'].forEach(evt =>
  leftPanel.addEventListener(evt, e => {
    e.preventDefault();
    leftPanel.classList.add('dragover');
  })
);
['dragleave', 'drop'].forEach(evt =>
  leftPanel.addEventListener(evt, e => {
    e.preventDefault();
    leftPanel.classList.remove('dragover');
  })
);
leftPanel.addEventListener('drop', e => {
  handleFileSelection(Array.from(e.dataTransfer.files));
});

dragArea.addEventListener('click', () => fileInput.click());

// ê¸°ì¡´ ë Œë”ë§ í•¨ìˆ˜ ë“±ì€ ê·¸ëŒ€ë¡œ ìœ ì§€
function renderPreviewCards() {
  previewCardContainer.innerHTML = '';
  [...selectedFiles].slice().reverse().forEach((file, idx) => {
    const realIdx = selectedFiles.length - 1 - idx;
    const item = document.createElement('div');
    item.className = 'preview-item';
    item.innerHTML = `
      <img src="pdf_icon.png" alt="PDF Icon">
      <div class="filename" title="${file.name}">${file.name}</div>
      <div style="color:#666;font-size:0.9em;margin-left:10px;">${(file.size/1024/1024).toFixed(2)} MB</div>
      <span class="remove-btn" data-idx="${realIdx}" title="ì‚­ì œ"><i class="fas fa-times"></i></span>
    `;
    previewCardContainer.appendChild(item);
  });
  previewCardContainer.querySelectorAll('.remove-btn').forEach(btn => {
    btn.onclick = () => {
      selectedFiles.splice(+btn.dataset.idx, 1);
      if (selectedFiles.length === 0) {
        uploadHeadArea.style.display = '';
        addFileBtn.style.display = 'none';
      }
      renderPreviewCards();
    };
  });
}

// â–¶ ì¶”ê°€: ë‚´ ì—…ë¡œë“œ í˜„í™© ë¶ˆëŸ¬ì˜¤ê¸°
async function loadMyUploads() {
  try {
    // 1) API í˜¸ì¶œ
    const res = await fetch('/api/my-uploads', { credentials: 'include' });
    // 2) JSON ê²°ê³¼ë¥¼ uploads ë³€ìˆ˜ì— ë‹´ì•„ì£¼ì„¸ìš”
    const uploads = await res.json();

    // 3) ê¸°ì¡´ í™”ë©´ ì´ˆê¸°í™”
    uploadCardContainer.innerHTML     = '';
    completedCardContainer.innerHTML  = '';
    rejectedBody.innerHTML            = '';
    selectedIds = [];
    deleteBtn.disabled = true;

    // 4) ê° í•­ëª© ë Œë”ë§
    uploads.forEach(item => {
      const { id, filename, status, completed_at, reject_reason } = item;

      if (status === 'ë°˜ë ¤') {
        // ë°˜ë ¤: í…Œì´ë¸”ì— ë²ˆí˜¸ ì—†ì´ íŒŒì¼ëª…, ì‚¬ìœ ë§Œ
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${filename}</td>
          <td>${reject_reason}</td>
        `;
        rejectedBody.appendChild(tr);

      } else {
        // í™•ì¸ì¤‘ / ì œì‘ì¤‘ / ì™„ë£Œìš© ì¹´ë“œ
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.id = id;

        let text, icon, cls;
        if (status === 'í™•ì¸ì¤‘') {
          icon = 'pending.gif';
          cls  = 'status-working';
          text = `ì‹œí—˜ì§€ í™•ì¸ì¤‘<span class="dots">
                    <span>.</span><span>.</span><span>.</span>
                    <span>.</span><span>.</span><span>.</span>
                  </span>`;
          card.addEventListener('click', () => toggleSelection(card, id));

        } else if (status === 'ì œì‘ì¤‘') {
          icon = 'working.gif';
          cls  = 'status-working';
          text = `ì‹œí—˜ì§€ ì œì‘ì¤‘<span class="dots">
                    <span>.</span><span>.</span><span>.</span>
                    <span>.</span><span>.</span><span>.</span>
                  </span>`;

        } else { // ì™„ë£Œ
          icon = 'done.gif';
          cls  = 'status-completed';
          // â˜… ì¹´ë“œ ì»¨í…Œì´ë„ˆì—ë„ í´ë˜ìŠ¤ ì¶”ê°€
          card.classList.add('status-completed');
          text = `ì‹œí—˜ì§€ ì‘ì—… ì™„ë£Œ ğŸ‰`;
        }

        card.innerHTML = `
          <div class="card-label" data-fullname="${filename}">${filename}</div>
          <img src="${icon}" alt="${status}">
          <div class="card-status ${cls}">${text}</div>
        `;

        // ì—…ë¡œë“œ / ì™„ë£Œ ì˜ì—­ì— ë¶„ê¸°
        if (status === 'ì™„ë£Œ') {
          completedCardContainer.appendChild(card);
        } else {
          uploadCardContainer.appendChild(card);
        }
      }
    });

  } catch (e) {
    console.error('ì—…ë¡œë“œ í˜„í™© ë¡œë“œ ì‹¤íŒ¨:', e);
  }
}

// ì—…ë¡œë“œ ë²„íŠ¼ í´ë¦­ ë¡œì§ë„ ê·¸ëŒ€ë¡œ
uploadBtn.addEventListener('click', async () => {
  if (!selectedFiles.length) {
    alert('ì—…ë¡œë“œí•  íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”!');
    return;
  }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   // (1) í™•ì¸/ì·¨ì†Œ ëª¨ë‹¬
  if (!confirm('íŒŒì¼ì„ ì •ë§ ì—…ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    return;
  }

  uploadBtn.disabled = true;
  uploadBtn.innerText = 'ì—…ë¡œë“œ ì¤‘...';

  const formData = new FormData();
  selectedFiles.forEach(file => formData.append('fileInput', file));
  const res = await fetch('/api/user-upload', {
    method: 'POST',
    credentials: 'include',
    body: formData
  });

  if (res.ok) {
    selectedFiles = [];
    renderPreviewCards();
    // ì—…ë¡œë“œ í›„ì—ë„ í—¤ë”ëŠ” ìˆ¨ê¸´ ì±„ë¡œ
    uploadHeadArea.style.display = 'none';
    addFileBtn.style.display = 'none';
    uploadBtn.disabled = false;
    uploadBtn.innerText = 'íŒŒì¼ ì—…ë¡œë“œ';
    loadMyUploads();

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // (2) ì—…ë¡œë“œ ì™„ë£Œ ì•Œë¦¼
    alert('ì—…ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
  } else {
    alert('ì—…ë¡œë“œ ì‹¤íŒ¨');
    uploadBtn.disabled = false;
    uploadBtn.innerText = 'íŒŒì¼ ì—…ë¡œë“œ';
  }
});

function toggleSelection(card, id) {
  if (card.classList.contains('selected')) {
    card.classList.remove('selected');
    selectedIds = selectedIds.filter(x => x !== id);
  } else {
    card.classList.add('selected');
    selectedIds.push(id);
  }
  deleteBtn.disabled = selectedIds.length === 0;
}

// â€œì‚­ì œí•˜ê¸°â€ ë²„íŠ¼ í´ë¦­ â†’ ëª¨ë‹¬ ì—´ê¸°
deleteBtn.addEventListener('click', () => {
  deleteModal.style.display = 'flex';
});

// ëª¨ë‹¬ ì·¨ì†Œ
cancelDelete.addEventListener('click', () => {
  deleteModal.style.display = 'none';
});

// ëª¨ë‹¬ì—ì„œ ì‚­ì œ í™•ì •
confirmDelete.addEventListener('click', async () => {
  // ëª¨ë‹¬ ë‹«ê¸°
  deleteModal.style.display = 'none';

  // ì„ íƒëœ IDë“¤ì— ëŒ€í•´ DELETE ìš”ì²­
  await Promise.all(selectedIds.map(id =>
    fetch(`/api/uploads/${id}`, {
      method: 'DELETE',
      credentials: 'include'
    })
  ));

  // ì‚­ì œ í›„ ëª©ë¡ ê°±ì‹  ë° ì„ íƒ ì´ˆê¸°í™”
  loadMyUploads();
  selectedIds = [];
  deleteBtn.disabled = true;
});

const adminMoveBtn = document.getElementById('admin-move-btn');
adminMoveBtn.addEventListener('click', () => {
  window.location.href = '/admin_upload_review.html';
});
fetch('/check-auth', { credentials: 'include' })
  .then(res => res.json())
  .then(data => {
    if (data.isLoggedIn && data.user.role === 'admin') {
      adminMoveBtn.style.display = 'inline-block';
    }
  })
  .catch(console.error);

// ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', () => {
  renderPreviewCards();
  loadMyUploads();
  // â–¶ ì¶”ê°€: 5ì´ˆë§ˆë‹¤ ì—…ë¡œë“œ í˜„í™© ê°±ì‹ 
  setInterval(loadMyUploads, 5000);
});
</script>
</html>