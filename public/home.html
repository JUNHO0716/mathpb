<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Welcome Banner</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">

<style>
  :root{
    --purple-bg:#ffffff;
    --purple-dk:#ffffff;
    --btn-bg:#FDC512;
    --btn-bg-hov:#D9A90F;
    --border-light:#e9e9e9;      /* ğŸ†• ì•„ì£¼ ì˜…ì€ íšŒìƒ‰ */
    --text-main:#111;
    --text-sub:#5f5f5f;
  }
  *{box-sizing:border-box;font-family:'Noto Sans KR',sans-serif;margin:0;}
  body{background:#fff;min-height:100vh;display:flex;flex-direction:column;}

  /* â”€â”€â”€â”€â”€â”€ 1) í—¤ë” â”€â”€â”€â”€â”€â”€ */
  .page-header{
    min-width:980px;padding:28px 40px 16px;
    display:flex;align-items:center;justify-content:space-between;
    position:relative;
  }
  .header-titles h1{font-size:1.55rem;font-weight:900;color:var(--text-main);}
  .sub-date{margin-top:4px;font-size:.95rem;font-weight:700;color:var(--text-sub);}

  .header-actions{display:flex;align-items:center;gap:16px;} /* ë²„íŠ¼ ê°„ê²© â†‘ */

  /* 1-a  ë²„íŠ¼ë“¤ */
  .action-btn{
    padding:8px 22px;border-radius:9999px;
    background:var(--btn-bg);color:#111;font-weight:700;
    font-size:.97rem;display:inline-flex;align-items:center;gap:8px;
    transition:.15s;text-decoration:none;
  }
  .action-btn i{font-size:.9rem;}
  .action-btn:hover{background:var(--btn-bg-hov);}
  /* ë²„íŠ¼ë¼ë¦¬ ì‚´ì§ ë„ìš°ê¸° */
  .action-btn+ .action-btn{margin-left:0;} 

  /* 1-b  í”„ë¡œí•„ */
  .user-wrapper{position:relative;}
  .user-box{
    display:flex;align-items:center;gap:14px;cursor:pointer; /* gap â†‘ */
  }
  .avatar{
    width:42px;height:42px;border-radius:50%;
    object-fit:cover;background:#ddd;
  }
  .user-name{
    font-size:1.05rem;font-weight:700;color:var(--text-main);
    white-space:nowrap;
  }
  .user-box i{font-size:.8rem;color:#888;transition:.2s;}

  .dropdown{
    position:absolute;right:0;top:calc(100% + 6px);
    min-width:160px;background:#fff;border:1px solid #eee;border-radius:10px;
    box-shadow:0 4px 14px rgba(0,0,0,.06);padding:8px 0;display:none;z-index:20;
  }
  .dropdown a{
    display:block;padding:10px 18px;font-size:.92rem;color:#333;
    text-decoration:none;white-space:nowrap;transition:.13s;
  }
  .dropdown a:hover{background:#f8f8f8;}

  /* â”€â”€â”€â”€â”€â”€ 2) ê´‘ê³  ë°°ë„ˆ (ì „ë©´ ì´ë¯¸ì§€ + ì—°ë³´ë¼ ë°±ì—…ìƒ‰) â”€â”€â”€â”€â”€â”€ */
  @media(max-width:1180px){
    .promo-banner.img-only{padding-top:38%;}
  }

   /* swiper-slide ì „ì²´ë¥¼ ë°°ë„ˆ ë†’ì´(260px)ì— ë§ì¶¤ */
    .adSwiper,
    .adSwiper .swiper-wrapper,
    .adSwiper .swiper-slide{
      width:100%;
      height:100%;
    }

    /* ì´ë¯¸ì§€ëŠ” ì˜ì—­ì„ ê½‰ ì±„ìš°ê³  ë¹„ìœ¨ ìœ ì§€(ì˜ë¦´ ìˆ˜ ìˆìŒ) */
    .adSwiper .swiper-slide img{
      width:100%;
      height:100%;
      object-fit:cover;
    }

  .promo-banner{
    margin:40px 40px;
    height:280px;
    border-radius:22px;
    overflow:hidden;
    width:calc(100% - 80px);
  }

  /* â–£ ëª¨ë‹¬ */
  .modal{position:fixed;inset:0;display:none;align-items:center;
        justify-content:center;background:rgba(0,0,0,.55);z-index:100;}
  .modal-content{max-width:580px;width:90%;background:#fff;border-radius:12px;
                padding:32px 28px;text-align:center;position:relative;}
  .modal-content img{max-width:100%;height:auto;border-radius:10px;}
  .modal-content p{margin-top:18px;font-size:1.05rem;line-height:1.6;}
  .modal-close{position:absolute;right:18px;top:14px;font-size:1.8rem;
              border:none;background:none;color:#555;cursor:pointer;}
  .modal-close:hover{color:#000;}

  .page-header::after{
  content:'';
  position:absolute;
  left:50%;                          /* ê°€ìš´ë° ê¸°ì¤€ */
  bottom:0;                          /* í—¤ë” ë§¨ ì•„ë˜ */
  transform:translateX(-50%);        /* ì •í™•í•œ ì¤‘ì•™ ì •ë ¬ */

  width:97%;                         /* â† ê¸¸ì´(=ì–‘ìª½ ì—¬ë°±) ì¡°ì ˆ í¬ì¸íŠ¸ */
  height:1px;                        /* ì„  êµµê¸° */
  background:var(--border-light);    /* ì„  ìƒ‰ìƒ */
  }
    /* â”€â”€â”€ ì¹´ë“œ ê°€ë¡œ ìŠ¤í¬ë¡¤ í–‰ â”€â”€â”€ */
    .h-scroll        {position:relative;margin:32px 40px;}
    .h-scroll .inner {display:flex;gap:16px;overflow-x:auto;
                      padding:12px 0;scroll-behavior:smooth;}
    .h-scroll .inner::-webkit-scrollbar{display:none;}

    .card-item{
      flex:0 0 210px;                 /* ì¹´ë“œ í­ */
      height:120px;
      border-radius:14px;
      background:#f7f8f9;
      box-shadow:0 2px 6px rgba(0,0,0,.04);
      display:flex;justify-content:center;align-items:center;
      font-weight:700;color:#333;
    }
    .my-desc{ display:none; }
    .modal-content iframe{
      width:100%;
      height:70vh;           /* ì›í•˜ëŠ” ë†’ì´ ë¹„ìœ¨ */
      border:0;
      border-radius:12px;
    }
    .dashboard-body{
      display:flex;
      flex-wrap:wrap;          /* â† wrap í—ˆìš© â†’ ë‘ ë²ˆì§¸ ì¤„ë¡œ ë‚´ë ¤ê° */
      gap:20px;
      margin:28px 40px 80px;   /* ì•„ë˜ 80px ì—¬ìœ  */
    }
    /* â”€â”€â”€ ì‚¬ìš©ì ì˜ì—­: í”„ë¡œí•„ + ì •ë³´ â”€â”€â”€ */
    .user-row{ width:340px; flex-shrink:0; display:flex; flex-direction:column;
           gap:20px; }     /* í”„ë¡œí•„ â†” ê³µì§€ì‚¬í•­ ê°„ê²©ë„ 20px */



    /* ê³ ì • í­ í”„ë¡œí•„ ì¹´ë“œ */
    .profile-card{
      width:300px;                      /* â† í•„ìš”í•˜ë©´ ì¡°ì • */
      background:#fff;
      border:1px solid var(--border-light);
      border-radius:22px;
      box-shadow:0 4px 12px rgba(0,0,0,.04);
      padding:32px 28px;
      display:flex;
      align-items:center;
      gap:20px;
    }
    /* í”„ë¡œí•„ ë‚´ë¶€ */
    .profile-card img{
      width:74px;height:74px;border-radius:50%;object-fit:cover;
    }
    .profile-card .info h3{
      font-size:1.15rem;font-weight:900;color:var(--text-main);
    }
    .profile-card .info .role{
      margin-top:4px;font-size:.95rem;color:var(--text-sub);
    }

    /* ì‚¬ìš©ì ì •ë³´ ì¹´ë“œ (ì˜¤ë¥¸ìª½) */
    .user-info-card .info-grid{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:24px 8px;
    }
    .user-info-card .label{
      font-size:.78rem;font-weight:700;color:var(--text-sub);
    }
    .user-info-card .value{
      font-size:.92rem;font-weight:900;color:var(--text-main);margin-top:4px;
    }

    .profile-card,
    .user-info-card{width:100%;}

    /* â”€â”€â”€ ê³µì§€ì‚¬í•­ ì¹´ë“œ (ì™¼ìª½ ì„¸ë¡œ ìŠ¤íƒ ë‘ë²ˆì§¸) â”€â”€â”€ */
    .notice-card{
      width:100%;
      background:#fff;
      border:1px solid var(--border-light);
      border-radius:22px;
      box-shadow:0 4px 12px rgba(0,0,0,.04);
      padding:32px 28px;
      flex:1;
      min-height:300px;          /* í‹€ë§Œ ë³´ì´ë„ë¡ */
    }
    .notice-card h2{
      font-size:1.12rem;
      font-weight:900;
      margin:0 0 10px 0;    /* ìœ„ìª½ ì—¬ë°± 0, ì•„ë˜ 10px */
    }

    /* â”€â”€â”€ â€˜ë‚´ ë¬¸ì œì§€â€™ ë°•ìŠ¤ (ì˜¤ë¥¸ìª½) â”€â”€â”€ */
    .mysheet-board{
      flex:1 1 420px;            /* min-width 420px  (+flexë¡œ ê°€ë³€)  */
      background:#fff;
      border:1px solid var(--border-light);
      border-radius:22px;
      box-shadow:0 4px 12px rgba(0,0,0,.04);
      padding:28px;
      min-height:420px;
    }
    .mysheet-board h2{font-size:1.25rem;font-weight:900;margin-bottom:22px;}

    /* â–¼ ê³µì§€ì‚¬í•­ ë¯¸ë¦¬ë³´ê¸° ìœ„ì ¯ */
    .notice-head{
      display:flex;align-items:center;justify-content:space-between;
      margin:-15px 0 10px 0;            /* h2 ì™€ ê°„ê²© */
    }
    .notice-arrows{display:flex;gap:4px;}
    .notice-arrow{
      width:18px; height:18px;          /* ë” ì‘ê²Œ */
      background:transparent;           /* ë°°ê²½ ì œê±° */
      border:none;
      color:#969595;                    /* ì´ˆë¡ ê³„ì—´ */
      font-size:1.65rem;                /* ì„  êµµê¸° & í¬ê¸° */
      line-height:16px;                 /* ì„¸ë¡œ ì •ë ¬ */
      cursor:pointer;
      padding:0;
      display:flex; align-items:center; justify-content:center;
      transition:color .13s;
    }
    .notice-arrow:hover{ color:#000000; }   /* ì‚´ì§ ì–´ë‘ì›Œì§ */
    .notice-arrow:disabled{ color:#cfd4cf; cursor:default; }  /* í•„ìš” ì‹œ */
    
    .notice-list{display:flex;flex-direction:column;gap:6px;}
    .notice-item{
      display:flex;align-items:center;height:28px;padding:0 2px;
      border-radius:6px;font-size:.95rem;cursor:pointer;
      transition:background .13s;overflow:hidden;
    }
    .notice-item:hover{background:#f5faf8;}
    .notice-num{
      min-width:18px;height:18px;background:#d0d2d6;color:#fff;
      border-radius:4px;font-size:.76rem;font-weight:700;
      display:flex;align-items:center;justify-content:center;
      margin-right:6px;
    }
    .notice-title{
      flex:1;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;
      color:#333;font-weight:500;font-size:.92rem;
    }

    /* ==============================================
   11. ìµœê·¼ ë‹¤ìš´ë¡œë“œ / ì—…ë¡œë“œ ì„¹ì…˜
   ============================================== */
    .recent-files-row{
      width:100%;              /* í•œ ì¤„ ì „ì²´ í­ ì‚¬ìš© */
      margin:24px 0 0;         /* ìœ„ìª½ 24px ê°„ê²© */
      display:flex; gap:24px;  /* ë‚´ë¶€ ì¹´ë“œ ê°„ê²©ì€ ê·¸ëŒ€ë¡œ */
      }
    .downloads-card,
    .uploads-card{
      background:#fff;
      border:1px solid var(--border-light);
      border-radius:22px;
      box-shadow:0 4px 12px rgba(0,0,0,.04);
      padding:28px 24px;
      display:flex;flex-direction:column;
    }
    .downloads-card{flex:2;}    /* 2/3 í­ */
    .uploads-card {flex:1;}     /* 1/3 í­ */

    .rf-header{
      font-size:1.15rem;font-weight:900;color:var(--text-main);
      display:flex;align-items:center;gap:8px;margin-bottom:18px;
    }
    .rf-table-wrap{flex:1;max-height:260px;overflow-y:auto;}
    .rf-table{
      width:100%;min-width:460px;border-collapse:collapse;
    }
    .rf-table thead{position:sticky;top:0;background:#f7f7f7;z-index:1;}
    .rf-table thead th { color:#555; }
    .rf-table th,.rf-table td{
      padding:10px 14px;font-size:.85rem;border-bottom:1px solid #eee;
      text-align:left;
    }
    .rf-table tbody tr:nth-child(even){background:#fafafa;}
    .rf-table td.title{color:#222;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:500;}
    .rf-table td.title:hover{text-decoration:underline;}
    .rf-table-wrap::-webkit-scrollbar{width:6px;}
    .rf-table-wrap::-webkit-scrollbar-thumb{background:rgba(0,0,0,.12);border-radius:4px;}
    .rf-table-wrap::-webkit-scrollbar-track{background:transparent;}
    .rf-table td:not(.title)   { text-align:center; }
    @media(max-width:900px){
      .recent-files-row{flex-direction:column;}
      .downloads-card,.uploads-card{flex:initial;}
    }

    .highlight {
      position: relative;
      display: inline-block;
    }

    .highlight::before {
      content: "";
      position: absolute;
      top: -4px;      /* ê¸€ì ìœ„ ìœ„ì¹˜ */
      left: 0;
      width: 30px;    /* ì„  ê¸¸ì´ */
      height: 5px;    /* ì„  êµµê¸° */
      background: #f8c900;  /* ë…¸ë€ìƒ‰ */
      border-radius: 2px;
    }

    .info.loading * { visibility: hidden; }

    #profileAvatar{
      opacity:0;                     /* ì²˜ìŒì—” íˆ¬ëª… */
      transition:opacity .6s ease;   /* 0.6ì´ˆ ë™ì•ˆ ë¶€ë“œëŸ½ê²Œ */
    }
    #profileAvatar.fade-in{opacity:1;}  /* í´ë˜ìŠ¤ê°€ ë¶™ìœ¼ë©´ ë‚˜íƒ€ë‚¨ */

</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css">
<script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
</head>
<body>

<!-- â–£ ê´‘ê³  ìŠ¬ë¼ì´ë” â–£ -->
<section class="promo-banner">
  <div class="swiper adSwiper">          <!-- â‘  Swiper ì»¨í…Œì´ë„ˆ -->
    <div class="swiper-wrapper">         <!-- â‘¡ ë˜í¼ -->
<!-- â‘¢ ìŠ¬ë¼ì´ë“œ: í•„ìš”ë§Œí¼ ë³µì‚¬í•´ì„œ ì¶”ê°€ -->
      <div class="swiper-slide" data-url="promo1.html">
        <img src="ad1.png" alt="ë°°ë„ˆ 1">
      </div>

      <div class="swiper-slide" data-url="promo2.html">
        <img src="ad2.png" alt="ë°°ë„ˆ 2">
      </div>

      <div class="swiper-slide" data-url="promo3.html">
        <img src="ad3.png" alt="ë°°ë„ˆ 3">
      </div>

      <div class="swiper-slide" data-url="promo4.html">
        <img src="ad4.png" alt="ë°°ë„ˆ 4">
      </div>
      </div>
   <div class="swiper-pagination"></div> <!-- í˜ì´ì§€ë„¤ì´ì…˜ì€ wrapper ë°– -->
 </div>                                   <!-- </div> adSwiper -->
</section>   

<section class="dashboard-body">

  <!-- (ì™¼ìª½) ì‚¬ìš©ì ì˜ì—­: í”„ë¡œí•„ + ì •ë³´ -->
  <div class="user-row">

    <!-- 1) í”„ë¡œí•„ ì¹´ë“œ -->
    <div class="profile-card">
      <img id="profileAvatar" alt="avatar">
     <div class="info loading">
      <!-- â˜… ì´ë¦„(id) + ì´ë©”ì¼(id) -->
    <h3 id="profileName">Guest</h3>
    <div id="profileEmail">guest@example.com</div>
  </div>
  </div>

    <!-- 2) ê³µì§€ì‚¬í•­ ì¹´ë“œ -->
    <div class="notice-card">
      <div class="notice-head">
        <h2 style="margin:0;">ê³µì§€ì‚¬í•­</h2>
        <div class="notice-arrows">
          <button class="notice-arrow" id="noticePrevBtn">&lt;</button>
          <button class="notice-arrow" id="noticeNextBtn">&gt;</button>
        </div>
      </div>
      <div id="noticeList" class="notice-list">
        <div style="text-align:center;color:#aaa;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </div>
    </div>
    </div>

    <!-- (ì˜¤ë¥¸ìª½) ë‚´ ë¬¸ì œì§€ -->
    <div class="mysheet-board">
      <h2>ë‚´ ë¬¸ì œì§€</h2>
      <!-- â˜… ë‚´ìš©ì€ ì¶”í›„ ì‚½ì… -->
    </div>

<!-- â–£ ìµœê·¼ ë‹¤ìš´ë¡œë“œ / ì—…ë¡œë“œ â–£ -->
<section class="recent-files-row">

  <!-- ì™¼ìª½ 2/3 â”‚ ìµœê·¼ ë‹¤ìš´ë¡œë“œ -->
  <div class="downloads-card">
    <div class="rf-header"><i class="fas fa-download"></i>ìµœê·¼ ë‹¤ìš´ë¡œë“œ</div>

    <div class="rf-table-wrap">
      <table class="rf-table">
        <thead>
          <tr>
            <th style="width:60%;">íŒŒì¼ëª…</th>
            <th style="width:20%;">ë¬¸ì œìˆ˜</th>
            <th style="width:20%;">ë‹¤ìš´ë¡œë“œì¼</th>
          </tr>
        </thead>
        <tbody>
          <!-- ì˜ˆì‹œ í–‰ë“¤ â”€ í•„ìš” ì‹œ JSë¡œ êµì²´ -->
          <tr><td class="title">25ê¸°ë§ í•„ìˆ˜ìœ í˜•(1)</td><td>40</td><td>2025-06-26</td></tr>
          <tr><td class="title">ì¤‘3 ë‚´ì‹  ëŒ€ë¹„ A</td><td>20</td><td>2025-06-25</td></tr>
          <tr><td class="title">ê³ 2 ëª¨ì˜ê³ ì‚¬ 6ì›”</td><td>30</td><td>2025-06-24</td></tr>
          <tr><td class="title">SAT ì‹¤ì „ëª¨ì˜ 2íšŒ</td><td>25</td><td>2025-06-23</td></tr>
          <tr><td class="title">ì˜ì¬ê³  ê²½ì‹œ ëª¨ìŒ</td><td>15</td><td>2025-06-22</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ì˜¤ë¥¸ìª½ 1/3 â”‚ ìµœê·¼ ì—…ë¡œë“œ -->
  <div class="uploads-card">
    <div class="rf-header"><i class="fas fa-upload"></i>ìµœê·¼ ì—…ë¡œë“œ</div>

    <div class="rf-table-wrap">
      <table class="rf-table">
        <thead>
          <tr>
            <th style="width:70%;">íŒŒì¼ëª…</th>
            <th style="width:30%;">ì—…ë¡œë“œì¼</th>
          </tr>
        </thead>
        <tbody>
          <tr><td class="title">25ë…„ 2í•™ê¸° ì¤‘ê°„ ë²”ìœ„</td><td>2025-06-26</td></tr>
          <tr><td class="title">ê³ 1 ìˆ˜ëŠ¥íŠ¹ê°• 1ë‹¨ì›</td><td>2025-06-25</td></tr>
          <tr><td class="title">ì¤‘2 ê¸°ë§ ì˜ˆìƒ (B)</td><td>2025-06-24</td></tr>
          <tr><td class="title">ìˆ˜ë¦¬ë…¼ìˆ  ëŒ€ë¹„ Set</td><td>2025-06-23</td></tr>
          <tr><td class="title">ê³ 3 Nì œ ì—…ë¡œë“œ</td><td>2025-06-22</td></tr>
        </tbody>
      </table>
    </div>
  </div>

</section>

</section><!-- /.dashboard-body -->


<!-- â–£ íŒì—… ëª¨ë‹¬ â–£ -->
<div id="adModal" class="modal">
  <div class="modal-content">
    <button class="modal-close" aria-label="ë‹«ê¸°">&times;</button>
    <img id="modalImg" src="" alt="">
    <p id="modalDesc"></p>
  </div>
</div>
<script>

  const avatar = document.getElementById('profileAvatar');
avatar.onload = () => {                    // src ê°€ ë°”ë€Œì–´ ì´ë¯¸ì§€ê°€ ë¡œë“œë  ë•Œë§ˆë‹¤
  avatar.classList.remove('fade-in');      // (ì¬ì‚¬ìš© ëŒ€ë¹„) ì´ˆê¸°í™”
  requestAnimationFrame(() => avatar.classList.add('fade-in'));
};
/* 1) ì˜¤ëŠ˜ ë‚ ì§œ */
const wk=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
const mo=['January','February','March','April','May','June','July','August','September','October','November','December'];
function setToday(){
  const t=new Date();
  document.getElementById('todayTxt').textContent=
    `${wk[t.getDay()]}  ${String(t.getDate()).padStart(2,'0')} ${mo[t.getMonth()]} ${t.getFullYear()}`;
}

/* 2) ë¡œê·¸ì¸ ì •ë³´ ë°˜ì˜ */
    async function bindUser(){
      try{
        const res = await fetch('/check-auth?ts=' + Date.now(), {credentials:'include', cache:'no-store'});
        const d = await res.json();
        if(!d.isLoggedIn) return;

        const u = d.user || {};
        let displayId = 'Guest';
        if (u.email) {
          displayId = u.email.split('@')[0];
        } else if (u.id) {
          displayId = u.id.split('@')[0];
        } else {
          displayId = u.name || 'User';
        }
        document.getElementById('profileName').textContent = displayId;
        document.getElementById('profileEmail').textContent = u.email || '-';

        const av = document.getElementById('profileAvatar');
        if (av) {
          avatar.classList.remove('fade-in');   // ë™ì¼ ì´ë¯¸ì§€ì¼ ë•Œë„ íš¨ê³¼ ì¬ì ìš©
          av.src = u.avatarUrl || 'icon_my_b.png';
          av.alt = displayId;
        }

        document.querySelector('.info').classList.remove('loading');
      } catch(e) { console.error(e); }
    }
    document.addEventListener('DOMContentLoaded', () => {
      bindUser();
    });

/* 3) ë“œë¡­ë‹¤ìš´ í† ê¸€ */
function initDropdown(){
  const box=document.getElementById('userBox');
  const menu=document.getElementById('dropdownMenu');
  const arrow=document.getElementById('arrowIcon');

  box.addEventListener('click',e=>{
    e.stopPropagation();
    const open=menu.style.display==='block';
    menu.style.display=open?'none':'block';
    arrow.style.transform=open?'rotate(0deg)':'rotate(180deg)';
  });
  document.addEventListener('click',e=>{
    if(!menu.contains(e.target)){
      menu.style.display='none';
      arrow.style.transform='rotate(0deg)';
    }
  });
}

/* 4) ê³µì§€ì‚¬í•­ ë¯¸ë¦¬ë³´ê¸° -------------------------------------- */
let noticeData=[];          // ì „ì²´ ëª©ë¡
let noticePage=0;           // 0:1~5, 1:6~10 â€¦
const NOTICE_PER_PAGE=5;

async function fetchNotices(){
  try{
    const res  = await fetch('/api/notices');
    noticeData = (await res.json()).slice(0,10)
                 .map(n=>({title:n.title || '(ì œëª©ì—†ìŒ)'}));
  }catch(e){
    console.error(e);
    noticeData = [{title:'ê³µì§€ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}];
  }
  renderNotices();
}

function renderNotices(){
  const listEl=document.getElementById('noticeList');
  if(!listEl) return;

  const start = noticePage*NOTICE_PER_PAGE;
  const view  = noticeData.slice(start,start+NOTICE_PER_PAGE);

  listEl.innerHTML = view.map((n,i)=>`
    <div class="notice-item">
      <span class="notice-num">${start+i+1}</span>
      <span class="notice-title">${n.title}</span>
    </div>`).join('');
}

/* ì¢Œìš° í™”ì‚´í‘œ ë²„íŠ¼ */
function bindNoticeButtons(){
  const prev=document.getElementById('noticePrevBtn');
  const next=document.getElementById('noticeNextBtn');
  if(!prev || !next) return;
  prev.onclick = ()=>{
    if(noticePage>0){ noticePage--; renderNotices(); }
  };
  next.onclick = ()=>{
    if((noticePage+1)*NOTICE_PER_PAGE < noticeData.length){
      noticePage++; renderNotices();
    }
  };
}

/* â”€â”€ Swiper ê´‘ê³ ë°°ë„ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const adSwiper = new Swiper('.adSwiper', {
  loop: true,
  grabCursor: true,
  autoplay: { delay: 5000 },
  pagination: {
    el: '.adSwiper .swiper-pagination',
    clickable: true,
  
  },
});


/* 5ì´ˆë§ˆë‹¤ ìë™ ìŠ¬ë¼ì´ë“œ */
setInterval(()=>{
  if(!noticeData.length) return;
  noticePage = (noticePage+1) % Math.ceil(noticeData.length/NOTICE_PER_PAGE);
  renderNotices();
},5000);

/* ì‹¤í–‰ */
document.addEventListener('DOMContentLoaded', () => {
  /* ë‚ ì§œÂ·ë¡œê·¸ì¸Â·ë“œë¡­ë‹¤ìš´ */
  setToday();
  bindUser();
  initDropdown();

  /* ê³µì§€ì‚¬í•­ ë²„íŠ¼Â·ë°ì´í„° ì´ˆê¸°í™” */
  bindNoticeButtons();   // â† ì¶”ê°€
  fetchNotices();        // â† ì¶”ê°€


    /* â”€â”€ ëª¨ë‹¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const modal     = document.getElementById('adModal');
    const modalBox  = document.querySelector('.modal-content');   // ê»ë°ê¸°
    const closeBtn  = document.querySelector('.modal-close');

    document.querySelectorAll('.adSwiper .swiper-slide').forEach(slide => {
      slide.addEventListener('click', () => {

        // 1) ì´ì „ ë‚´ìš© ëª¨ë‘ ì œê±°
        modalBox.querySelectorAll('iframe, img, p').forEach(el => el.remove());

        // 2) iframe ìƒì„±
        const url = slide.dataset.url;
        const frame = document.createElement('iframe');
        frame.src = url;
        modalBox.insertBefore(frame, closeBtn.nextSibling); // ë²„íŠ¼ ë°”ë¡œ ë’¤ì— ì‚½ì…

        // 3) ëª¨ë‹¬ ë„ìš°ê³  ìë™ ìŠ¬ë¼ì´ë“œ ë©ˆì¶¤
        modal.style.display = 'flex';
        adSwiper.autoplay.stop();
      });
    });

    /* ë‹«ê¸° ë²„íŠ¼ & ë°°ê²½ í´ë¦­ */
    const hideModal = () => {
      modal.style.display = 'none';
      modalBox.querySelector('iframe')?.remove();    // iframe ì œê±°
      adSwiper.autoplay.start();
    };
    closeBtn.onclick = hideModal;
    modal.onclick = e => { if(e.target === modal) hideModal(); };

});
</script>
</body>
</html>
